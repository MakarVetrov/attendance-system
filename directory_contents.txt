СКАНИРОВАНИЕ ДИРЕКТОРИИ: C:\Users\Makar\Desktop\kyrsovay
====================================================================================================


================================================================================
ФАЙЛ: db.py
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\db.py
РАЗМЕР: 3176 байт
================================================================================

import psycopg2
from psycopg2 import Error
import pandas as pd

class Database:
    def __init__(self, host='localhost', database='attendance_db', user='postgres', password='123654789'):
        self.host = host
        self.database = database
        self.user = user
        self.password = password
        self.conn = None

    def connect(self):
        try:
            self.conn = psycopg2.connect(
                host=self.host,
                database=self.database,
                user=self.user,
                password=self.password
            )
            return True
        except Error as e:
            print(f"Ошибка подключения: {e}")
            return False

    def close(self):
        if self.conn:
            self.conn.close()

    def execute_query(self, query, params=None, fetch=True):
        if not self.conn:
            print("Нет соединения с БД")
            return None
        
        try:
            cur = self.conn.cursor()
            if params:
                cur.execute(query, params)
            else:
                cur.execute(query)
            
            if fetch and query.strip().upper().startswith('SELECT'):
                result = cur.fetchall()
            else:
                result = None
            
            cur.close()
            return result
        except Error as e:
            print(f"Ошибка выполнения запроса: {e}")
            print(f"Запрос: {query}")
            if params:
                print(f"Параметры: {params}")
            return None

    def execute_insert(self, query, params=None, return_id=False):
        if not self.conn:
            print("Нет соединения с БД")
            return False
        
        try:
            cur = self.conn.cursor()
            if params:
                cur.execute(query, params)
            else:
                cur.execute(query)
            
            if return_id and 'RETURNING' in query.upper():
                result = cur.fetchone()[0]
            else:
                result = True
                
            self.conn.commit()
            cur.close()
            return result if return_id else True
        except Error as e:
            print(f"Ошибка вставки/обновления данных: {e}")
            self.conn.rollback()
            return False

    def get_id_by_name(self, table, column, value):
        if not self.conn:
            return None
        
        try:
            query = f"SELECT id FROM {table} WHERE {column} = %s"
            result = self.execute_query(query, (value,))
            return result[0][0] if result else None
        except Exception as e:
            print(f"Ошибка при получении ID: {e}")
            return None

    def get_user_by_login(self, login):
        query = """
        SELECT id, login, password_hash, full_name, role, group_id 
        FROM users 
        WHERE login = %s
        """
        return self.execute_query(query, (login,))

================================================================================
ФАЙЛ: directory_contents.txt
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\directory_contents.txt
РАЗМЕР: 0 байт
================================================================================



================================================================================
ФАЙЛ: main.py
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\main.py
РАЗМЕР: 56545 байт
================================================================================

from flask import Flask, render_template, request, redirect, url_for, session, flash, jsonify
from db import Database
from datetime import datetime, date, timedelta
import calendar

app = Flask(__name__)
app.secret_key = 'your-secret-key-here'
app.config['PERMANENT_SESSION_LIFETIME'] = timedelta(hours=2)

db = Database()

# ========== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ==========

def get_today_schedule(user_id, user_role, group_id=None):
    """Получить расписание на сегодня"""
    today = date.today()
    
    if user_role == 'Студент':
        query = """
        SELECT s.id, d.name, s.lesson_time, s.classroom, s.lesson_type, 
               u.full_name as teacher_name, s.lesson_date
        FROM schedule s
        JOIN disciplines d ON s.discipline_id = d.id
        JOIN users u ON s.teacher_id = u.id
        WHERE s.group_id = %s AND s.lesson_date = %s
        ORDER BY s.lesson_time
        """
        result = db.execute_query(query, (group_id, today))
        # Добавляем дату к результату
        return result
    
    elif user_role == 'Преподаватель':
        query = """
        SELECT s.id, d.name, s.lesson_time, s.classroom, s.lesson_type,
               g.group_code, s.lesson_date
        FROM schedule s
        JOIN disciplines d ON s.discipline_id = d.id
        JOIN student_groups g ON s.group_id = g.id
        WHERE s.teacher_id = %s AND s.lesson_date = %s
        ORDER BY s.lesson_time
        """
        return db.execute_query(query, (user_id, today))
    
    else:  # Администратор
        query = """
        SELECT s.id, d.name, s.lesson_time, s.classroom, s.lesson_type,
               g.group_code, u.full_name as teacher_name, s.lesson_date
        FROM schedule s
        JOIN disciplines d ON s.discipline_id = d.id
        JOIN student_groups g ON s.group_id = g.id
        JOIN users u ON s.teacher_id = u.id
        WHERE s.lesson_date = %s
        ORDER BY s.lesson_time, g.group_code
        """
        return db.execute_query(query, (today,))

def get_student_attendance(student_id, start_date=None, end_date=None):
    """Получить посещаемость студента за период"""
    if not start_date:
        start_date = date.today() - timedelta(days=30)
    if not end_date:
        end_date = date.today()
    
    query = """
    SELECT a.id, d.name, s.lesson_date, s.lesson_time, a.status, a.notes,
           u.full_name as teacher_name, s.classroom
    FROM attendance a
    JOIN schedule s ON a.schedule_id = s.id
    JOIN disciplines d ON s.discipline_id = d.id
    JOIN users u ON s.teacher_id = u.id
    WHERE a.student_id = %s AND s.lesson_date BETWEEN %s AND %s
    ORDER BY s.lesson_date DESC, s.lesson_time DESC
    """
    return db.execute_query(query, (student_id, start_date, end_date))

def get_group_students(group_id):
    """Получить всех студентов группы"""
    query = """
    SELECT id, full_name, login, email
    FROM users
    WHERE role = 'Студент' AND group_id = %s
    ORDER BY full_name
    """
    return db.execute_query(query, (group_id,))

def get_teacher_disciplines(teacher_id):
    """Получить дисциплины преподавателя с названиями групп"""
    query = """
    SELECT d.id, d.name, d.total_hours,
           COALESCE(STRING_AGG(g.group_code, ', ' ORDER BY g.group_code), 'Нет групп') as group_names
    FROM disciplines d
    LEFT JOIN group_disciplines gd ON d.id = gd.discipline_id
    LEFT JOIN student_groups g ON gd.group_id = g.id
    WHERE d.teacher_id = %s
    GROUP BY d.id, d.name, d.total_hours
    ORDER BY d.name
    """
    return db.execute_query(query, (teacher_id,))

# ========== МАРШРУТЫ АУТЕНТИФИКАЦИИ ==========

@app.route('/')
def index():
    return redirect(url_for('login'))

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        login = request.form['login']
        password = request.form['password']
        
        result = db.get_user_by_login(login)
        
        if result and result[0][2] == password:  # Простая проверка пароля
            session['user_id'] = result[0][0]
            session['login'] = result[0][1]
            session['full_name'] = result[0][3]
            session['role'] = result[0][4]
            session['group_id'] = result[0][5] if result[0][5] else None
            
            flash(f'Добро пожаловать, {result[0][3]}!')
            return redirect(url_for('dashboard'))
        else:
            flash('Неверный логин или пароль')
    
    return render_template('login.html')

@app.route('/logout')
def logout():
    session.clear()
    flash('Вы вышли из системы')
    return redirect(url_for('login'))

@app.route('/dashboard')
def dashboard():
    if 'user_id' not in session:
        return redirect(url_for('login'))
    
    user_id = session['user_id']
    role = session['role']
    group_id = session.get('group_id')
    
    # Получаем расписание на сегодня
    today_schedule = get_today_schedule(user_id, role, group_id)
    today_date = date.today()
    
    if role == 'Студент':
        # Получаем дисциплины студента
        query = """
        SELECT d.name, d.total_hours, gd.semester
        FROM group_disciplines gd
        JOIN disciplines d ON gd.discipline_id = d.id
        WHERE gd.group_id = %s
        ORDER BY d.name
        """
        disciplines = db.execute_query(query, (group_id,)) if group_id else []
        
        # Получаем статистику посещаемости
        start_date = date.today() - timedelta(days=30)
        attendance_stats = db.execute_query("""
            SELECT 
                COUNT(*) as total_classes,
                SUM(CASE WHEN status = 'Присутствовал' THEN 1 ELSE 0 END) as attended,
                SUM(CASE WHEN status = 'Отсутствовал' THEN 1 ELSE 0 END) as absent,
                SUM(CASE WHEN status = 'По уважительной причине' THEN 1 ELSE 0 END) as excused,
                SUM(CASE WHEN status = 'Опоздал' THEN 1 ELSE 0 END) as late
            FROM attendance a
            JOIN schedule s ON a.schedule_id = s.id
            WHERE a.student_id = %s AND s.lesson_date BETWEEN %s AND %s
        """, (user_id, start_date, date.today()))

        stats = attendance_stats[0] if attendance_stats else (0, 0, 0, 0, 0)
        
        # Получаем название группы для отображения
        group_name = ""
        if group_id:
            group_query = "SELECT group_code FROM student_groups WHERE id = %s"
            group_info = db.execute_query(group_query, (group_id,))
            if group_info:
                group_name = group_info[0][0]
                session['group_name'] = group_name
        
        return render_template('student_dashboard.html',
                             full_name=session['full_name'],
                             role=role,
                             today_schedule=today_schedule,
                             disciplines=disciplines,
                             stats=stats,
                             today_date=today_date,
                             group_name=group_name)
    
    elif role == 'Преподаватель':
        disciplines = get_teacher_disciplines(user_id)
        
        groups_query = """
        SELECT DISTINCT g.id, g.group_code
        FROM schedule s
        JOIN student_groups g ON s.group_id = g.id
        WHERE s.teacher_id = %s
        ORDER BY g.group_code
        """
        groups = db.execute_query(groups_query, (user_id,))
        
        return render_template('teacher_dashboard.html',
                             full_name=session['full_name'],
                             role=role,
                             today_schedule=today_schedule,
                             disciplines=disciplines,
                             groups=groups,
                             today_date=today_date)
    
    else:  # Администратор
        # Статистика системы
        stats_query = """
        SELECT 
            (SELECT COUNT(*) FROM users WHERE role = 'Студент') as student_count,
            (SELECT COUNT(*) FROM users WHERE role = 'Преподаватель') as teacher_count,
            (SELECT COUNT(*) FROM student_groups) as group_count,
            (SELECT COUNT(*) FROM disciplines) as discipline_count
        """
        stats = db.execute_query(stats_query)[0] if db.execute_query(stats_query) else (0, 0, 0, 0)
        
        # Текущее время
        from datetime import datetime
        now = datetime.now()
        
        return render_template('admin_dashboard.html',
                             full_name=session['full_name'],
                             role=role,
                             today_schedule=today_schedule,
                             stats=stats,
                             today_date=today_date,
                             now=now)

# ========== МАРШРУТЫ ДЛЯ СТУДЕНТОВ ==========

@app.route('/student/schedule')
def student_schedule():
    if session.get('role') != 'Студент':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    group_id = session.get('group_id')
    if not group_id:
        flash('Вы не привязаны к группе')
        return redirect(url_for('dashboard'))
    
    # Получаем параметры даты
    week_offset = request.args.get('week_offset', 0, type=int)
    today = date.today()
    target_date = today + timedelta(weeks=week_offset)
    
    # Находим начало и конец недели
    start_of_week = target_date - timedelta(days=target_date.weekday())
    end_of_week = start_of_week + timedelta(days=6)
    
    # Получаем информацию о группе
    group_query = "SELECT group_code FROM student_groups WHERE id = %s"
    group_info = db.execute_query(group_query, (group_id,))
    group_name = group_info[0][0] if group_info else "Неизвестная группа"
    
    # Получаем расписание на неделю
    query = """
    SELECT s.id, d.name, s.lesson_date, s.lesson_time, s.classroom, 
           s.lesson_type, u.full_name as teacher_name
    FROM schedule s
    JOIN disciplines d ON s.discipline_id = d.id
    JOIN users u ON s.teacher_id = u.id
    WHERE s.group_id = %s AND s.lesson_date BETWEEN %s AND %s
    ORDER BY s.lesson_date, s.lesson_time
    """
    
    schedule = db.execute_query(query, (group_id, start_of_week, end_of_week))
    
    # Группируем по дням
    schedule_by_day = {}
    for item in schedule:
        day = item[2]
        if day not in schedule_by_day:
            schedule_by_day[day] = []
        schedule_by_day[day].append(item)
    
    return render_template('student_schedule.html',
                         schedule_by_day=schedule_by_day,
                         start_of_week=start_of_week,
                         end_of_week=end_of_week,
                         week_offset=week_offset,
                         group_name=group_name,
                         full_name=session['full_name'],
                         today_date=today)  # Добавлено

@app.route('/student/attendance')
def student_attendance():
    if session.get('role') != 'Студент':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    # Получаем параметры фильтрации
    start_date = request.args.get('start_date')
    end_date = request.args.get('end_date')
    
    if start_date:
        start_date = datetime.strptime(start_date, '%Y-%m-%d').date()
    if end_date:
        end_date = datetime.strptime(end_date, '%Y-%m-%d').date()
    
    attendance = get_student_attendance(session['user_id'], start_date, end_date)
    
    return render_template('student_attendance.html',
                         attendance=attendance,
                         start_date=start_date or (date.today() - timedelta(days=30)),
                         end_date=end_date or date.today())

@app.route('/student/disciplines')
def student_disciplines():
    if session.get('role') != 'Студент':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    group_id = session.get('group_id')
    if not group_id:
        flash('Вы не привязаны к группе')
        return redirect(url_for('dashboard'))
    
    query = """
    SELECT d.id, d.name, d.description, d.total_hours, gd.semester,
           u.full_name as teacher_name,
           (SELECT COUNT(*) FROM attendance a 
            JOIN schedule s ON a.schedule_id = s.id 
            WHERE s.discipline_id = d.id AND a.student_id = %s) as attended_classes
    FROM group_disciplines gd
    JOIN disciplines d ON gd.discipline_id = d.id
    JOIN users u ON d.teacher_id = u.id
    WHERE gd.group_id = %s
    ORDER BY d.name
    """
    
    disciplines = db.execute_query(query, (session['user_id'], group_id))
    
    return render_template('student_disciplines.html', disciplines=disciplines)

# ========== МАРШРУТЫ ДЛЯ ПРЕПОДАВАТЕЛЕЙ ==========

@app.route('/teacher/discipline/edit/<int:discipline_id>', methods=['GET', 'POST'])
def edit_discipline(discipline_id):
    if session.get('role') != 'Преподаватель':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    teacher_id = session['user_id']
    
    # Проверяем, принадлежит ли дисциплина преподавателю
    check_query = "SELECT id FROM disciplines WHERE id = %s AND teacher_id = %s"
    check_result = db.execute_query(check_query, (discipline_id, teacher_id))
    
    if not check_result:
        flash('Дисциплина не найдена или у вас нет прав на ее редактирование')
        return redirect(url_for('teacher_disciplines'))
    
    if request.method == 'POST':
        name = request.form['name']
        description = request.form.get('description', '')
        total_hours = int(request.form['total_hours'])
        
        # Обновляем дисциплину
        update_query = """
        UPDATE disciplines 
        SET name = %s, description = %s, total_hours = %s
        WHERE id = %s AND teacher_id = %s
        """
        
        if db.execute_insert(update_query, (name, description, total_hours, discipline_id, teacher_id)):
            # Обновляем группы (можно добавить логику изменения групп)
            flash('Дисциплина успешно обновлена')
            return redirect(url_for('teacher_disciplines'))
    
    # GET запрос - получаем данные дисциплины
    discipline_query = """
    SELECT d.name, d.description, d.total_hours,
           STRING_AGG(g.group_code, ', ') as group_names
    FROM disciplines d
    LEFT JOIN group_disciplines gd ON d.id = gd.discipline_id
    LEFT JOIN student_groups g ON gd.group_id = g.id
    WHERE d.id = %s AND d.teacher_id = %s
    GROUP BY d.id, d.name, d.description, d.total_hours
    """
    
    discipline_data = db.execute_query(discipline_query, (discipline_id, teacher_id))
    
    if not discipline_data:
        flash('Дисциплина не найдена')
        return redirect(url_for('teacher_disciplines'))
    
    # Получаем все группы для выбора
    groups_query = "SELECT id, group_code FROM student_groups ORDER BY group_code"
    groups = db.execute_query(groups_query)
    
    return render_template('edit_discipline.html',
                         discipline=discipline_data[0],
                         discipline_id=discipline_id,
                         groups=groups)

# ========== ДОПОЛНИТЕЛЬНЫЕ МАРШРУТЫ ДЛЯ ПРЕПОДАВАТЕЛЕЙ ==========

@app.route('/teacher/discipline/delete/<int:discipline_id>', methods=['POST'])
def delete_discipline(discipline_id):
    if session.get('role') != 'Преподаватель':
        flash('Доступ запрещен', 'danger')
        return redirect(url_for('dashboard'))
    
    teacher_id = session['user_id']
    
    # Проверяем, принадлежит ли дисциплина преподавателю
    check_query = "SELECT id, name FROM disciplines WHERE id = %s AND teacher_id = %s"
    check_result = db.execute_query(check_query, (discipline_id, teacher_id))
    
    if not check_result:
        flash('Дисциплина не найдена или у вас нет прав на ее удаление', 'danger')
        return redirect(url_for('teacher_disciplines'))
    
    discipline_name = check_result[0][1]
    
    # Удаляем дисциплину (cascade удалит связанные записи)
    delete_query = "DELETE FROM disciplines WHERE id = %s AND teacher_id = %s"
    
    if db.execute_insert(delete_query, (discipline_id, teacher_id)):
        flash(f'Дисциплина "{discipline_name}" успешно удалена', 'success')
    else:
        flash('Ошибка при удалении дисциплины', 'danger')
    
    return redirect(url_for('teacher_disciplines'))

@app.route('/teacher/discipline/manage_groups/<int:discipline_id>', methods=['GET', 'POST'])
def manage_discipline_groups(discipline_id):
    if session.get('role') != 'Преподаватель':
        flash('Доступ запрещен', 'danger')
        return redirect(url_for('dashboard'))
    
    teacher_id = session['user_id']
    
    # Проверяем, принадлежит ли дисциплина преподавателю
    check_query = """
    SELECT d.id, d.name 
    FROM disciplines d
    WHERE d.id = %s AND d.teacher_id = %s
    """
    check_result = db.execute_query(check_query, (discipline_id, teacher_id))
    
    if not check_result:
        flash('Дисциплина не найдена или у вас нет прав на ее редактирование', 'danger')
        return redirect(url_for('teacher_disciplines'))
    
    discipline_name = check_result[0][1]
    
    if request.method == 'POST':
        # Получаем выбранные группы из формы
        selected_groups = request.form.getlist('groups')
        
        # Удаляем все текущие связи дисциплины с группами
        delete_query = "DELETE FROM group_disciplines WHERE discipline_id = %s"
        db.execute_insert(delete_query, (discipline_id,))
        
        # Добавляем новые связи
        success = True
        for group_id in selected_groups:
            semester = request.form.get(f'semester_{group_id}', 1)
            if not db.execute_insert(
                "INSERT INTO group_disciplines (group_id, discipline_id, semester) VALUES (%s, %s, %s)",
                (group_id, discipline_id, semester)
            ):
                success = False
        
        if success:
            flash(f'Группы для дисциплины "{discipline_name}" успешно обновлены', 'success')
            return redirect(url_for('teacher_disciplines'))
        else:
            flash('Ошибка при обновлении групп', 'danger')
    
    # GET запрос - получаем данные
    # Получаем информацию о дисциплине
    discipline_query = "SELECT name, description, total_hours FROM disciplines WHERE id = %s"
    discipline_data = db.execute_query(discipline_query, (discipline_id,))[0]
    
    # Получаем все группы
    groups_query = "SELECT id, group_code FROM student_groups ORDER BY group_code"
    all_groups = db.execute_query(groups_query)
    
    # Получаем текущие группы дисциплины
    current_groups_query = """
    SELECT gd.group_id, g.group_code, gd.semester
    FROM group_disciplines gd
    JOIN student_groups g ON gd.group_id = g.id
    WHERE gd.discipline_id = %s
    ORDER BY g.group_code
    """
    current_groups = db.execute_query(current_groups_query, (discipline_id,))
    
    # Создаем словарь для быстрого доступа к семестрам текущих групп
    current_groups_dict = {str(group[0]): group[2] for group in current_groups}
    
    return render_template('manage_discipline_groups.html',
                         discipline_id=discipline_id,
                         discipline_name=discipline_name,
                         discipline_data=discipline_data,
                         all_groups=all_groups,
                         current_groups_dict=current_groups_dict)

# Обновим функцию teacher_disciplines чтобы она показывала больше информации
@app.route('/teacher/disciplines')
def teacher_disciplines():
    if session.get('role') != 'Преподаватель':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    # Получаем дисциплины с количеством групп
    disciplines_query = """
    SELECT d.id, d.name, d.total_hours,
           COALESCE(STRING_AGG(g.group_code, ', ' ORDER BY g.group_code), 'Нет групп') as group_names,
           COUNT(DISTINCT gd.group_id) as group_count
    FROM disciplines d
    LEFT JOIN group_disciplines gd ON d.id = gd.discipline_id
    LEFT JOIN student_groups g ON gd.group_id = g.id
    WHERE d.teacher_id = %s
    GROUP BY d.id, d.name, d.total_hours
    ORDER BY d.name
    """
    
    disciplines = db.execute_query(disciplines_query, (session['user_id'],))
    
    return render_template('teacher_disciplines.html', disciplines=disciplines)

@app.route('/teacher/discipline/add', methods=['GET', 'POST'])
def add_discipline():
    if session.get('role') != 'Преподаватель':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    if request.method == 'POST':
        name = request.form['name']
        description = request.form.get('description', '')
        total_hours = int(request.form['total_hours'])
        teacher_id = session['user_id']
        
        # Проверяем, выбраны ли группы (хотя бы одна)
        groups = request.form.getlist('groups')
        if not groups:
            flash('Необходимо выбрать хотя бы одну группу', 'danger')
            return redirect(url_for('add_discipline'))
        
        # Проверяем семестры для выбранных групп
        group_semesters = {}
        for group_id in groups:
            semester = request.form.get(f'semester_{group_id}')
            if not semester:
                flash(f'Для выбранной группы необходимо указать семестр', 'danger')
                return redirect(url_for('add_discipline'))
            
            try:
                semester_int = int(semester)
                if semester_int < 1 or semester_int > 12:
                    flash(f'Семестр должен быть от 1 до 12', 'danger')
                    return redirect(url_for('add_discipline'))
                group_semesters[group_id] = semester_int
            except ValueError:
                flash(f'Некорректное значение семестра', 'danger')
                return redirect(url_for('add_discipline'))
        
        # Создаем дисциплину
        query = """
        INSERT INTO disciplines (name, description, total_hours, teacher_id)
        VALUES (%s, %s, %s, %s) RETURNING id
        """
        
        discipline_id = db.execute_insert(query, (name, description, total_hours, teacher_id), return_id=True)
        
        if discipline_id:
            # Добавляем группы к дисциплине
            success = True
            for group_id, semester in group_semesters.items():
                if not db.execute_insert(
                    "INSERT INTO group_disciplines (group_id, discipline_id, semester) VALUES (%s, %s, %s)",
                    (group_id, discipline_id, semester)
                ):
                    success = False
            
            if success:
                flash(f'Дисциплина "{name}" успешно добавлена для {len(groups)} группы(рупп)', 'success')
                return redirect(url_for('teacher_disciplines'))
            else:
                flash('Ошибка при добавлении групп к дисциплине', 'danger')
        else:
            flash('Ошибка при создании дисциплины', 'danger')
    
    # GET запрос - показываем форму
    groups_query = "SELECT id, group_code FROM student_groups ORDER BY group_code"
    groups = db.execute_query(groups_query)
    
    return render_template('add_discipline.html', groups=groups)

@app.route('/teacher/attendance/mark', methods=['GET', 'POST'])
def mark_attendance():
    if session.get('role') != 'Преподаватель':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    teacher_id = session['user_id']
    
    if request.method == 'POST':
        schedule_id = request.form['schedule_id']
        student_id = request.form['student_id']
        status = request.form['status']
        notes = request.form.get('notes', '')
        
        # Проверяем, существует ли уже запись о посещаемости
        check_query = "SELECT id FROM attendance WHERE student_id = %s AND schedule_id = %s"
        existing = db.execute_query(check_query, (student_id, schedule_id))
        
        if existing:
            # Обновляем существующую запись
            update_query = """
            UPDATE attendance 
            SET status = %s, notes = %s, marked_by = %s, marked_at = CURRENT_TIMESTAMP
            WHERE id = %s
            """
            db.execute_insert(update_query, (status, notes, teacher_id, existing[0][0]))
        else:
            # Создаем новую запись
            insert_query = """
            INSERT INTO attendance (student_id, schedule_id, status, notes, marked_by)
            VALUES (%s, %s, %s, %s, %s)
            """
            db.execute_insert(insert_query, (student_id, schedule_id, status, notes, teacher_id))
        
        # Возвращаем успешный ответ для AJAX
        if request.headers.get('X-Requested-With') == 'XMLHttpRequest':
            return jsonify({'success': True})
        
        flash('Посещаемость отмечена')
        return redirect(url_for('mark_attendance'))
    
    # GET запрос - показываем форму
    today = date.today()
    query = """
    SELECT s.id, d.name, s.lesson_time, g.group_code, s.classroom, s.lesson_type
    FROM schedule s
    JOIN disciplines d ON s.discipline_id = d.id
    JOIN student_groups g ON s.group_id = g.id
    WHERE s.teacher_id = %s AND s.lesson_date = %s
    ORDER BY s.lesson_time
    """
    
    today_classes = db.execute_query(query, (teacher_id, today))
    
    return render_template('mark_attendance.html', 
                         today_classes=today_classes,
                         today=today)

@app.route('/teacher/attendance/class/<int:schedule_id>')
def attendance_class(schedule_id):
    if session.get('role') != 'Преподаватель':
        return jsonify({'error': 'Доступ запрещен'}), 403
    
    # Получаем информацию о занятии
    class_query = """
    SELECT s.id, d.name, s.lesson_date, s.lesson_time, g.group_code, 
           s.classroom, s.lesson_type, g.id as group_id
    FROM schedule s
    JOIN disciplines d ON s.discipline_id = d.id
    JOIN student_groups g ON s.group_id = g.id
    WHERE s.id = %s AND s.teacher_id = %s
    """
    
    class_info = db.execute_query(class_query, (schedule_id, session['user_id']))
    if not class_info:
        return jsonify({'error': 'Занятие не найдено'}), 404
    
    # Получаем студентов группы
    group_id = class_info[0][7]  # group_id из запроса
    students_query = """
    SELECT id, full_name, login, email
    FROM users
    WHERE role = 'Студент' AND group_id = %s
    ORDER BY full_name
    """
    students = db.execute_query(students_query, (group_id,))
    
    # Получаем текущую посещаемость
    attendance_query = """
    SELECT student_id, status, notes
    FROM attendance
    WHERE schedule_id = %s
    """
    attendance_data = db.execute_query(attendance_query, (schedule_id,))
    attendance_dict = {row[0]: {'status': row[1], 'notes': row[2]} for row in attendance_data}
    
    return jsonify({
        'class_info': {
            'id': class_info[0][0],
            'name': class_info[0][1],
            'date': class_info[0][2].strftime('%d.%m.%Y'),
            'time': str(class_info[0][3]),
            'group': class_info[0][4],
            'classroom': class_info[0][5],
            'type': class_info[0][6]
        },
        'students': [
            {
                'id': s[0],
                'name': s[1],
                'login': s[2],
                'email': s[3],
                'status': attendance_dict.get(s[0], {}).get('status', 'Не отмечен'),
                'notes': attendance_dict.get(s[0], {}).get('notes', '')
            }
            for s in students
        ]
    })

@app.route('/teacher/statistics')
def teacher_statistics():
    if session.get('role') != 'Преподаватель':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    teacher_id = session['user_id']
    
    # Получаем параметры
    group_id = request.args.get('group_id')
    student_id = request.args.get('student_id')
    start_date = request.args.get('start_date')
    end_date = request.args.get('end_date')
    
    if start_date:
        start_date = datetime.strptime(start_date, '%Y-%m-%d').date()
    else:
        start_date = date.today() - timedelta(days=30)
    
    if end_date:
        end_date = datetime.strptime(end_date, '%Y-%m-%d').date()
    else:
        end_date = date.today()
    
    # Получаем группы преподавателя
    groups_query = """
    SELECT DISTINCT g.id, g.group_code
    FROM schedule s
    JOIN student_groups g ON s.group_id = g.id
    WHERE s.teacher_id = %s
    ORDER BY g.group_code
    """
    groups = db.execute_query(groups_query, (teacher_id,))
    
    # Получаем студентов выбранной группы
    students = []
    if group_id:
        students_query = """
        SELECT u.id, u.full_name
        FROM users u
        WHERE u.role = 'Студент' AND u.group_id = %s
        ORDER BY u.full_name
        """
        students = db.execute_query(students_query, (group_id,))
    
    statistics = None
    if group_id or student_id:
        # Строим запрос для статистики - ТОЛЬКО ДЛЯ СТУДЕНТОВ
        query = """
        SELECT 
            u.full_name,
            d.name as discipline,
            COUNT(*) as total_classes,
            SUM(CASE WHEN a.status = 'Присутствовал' THEN 1 ELSE 0 END) as attended,
            SUM(CASE WHEN a.status = 'Отсутствовал' THEN 1 ELSE 0 END) as absent,
            SUM(CASE WHEN a.status = 'По уважительной причине' THEN 1 ELSE 0 END) as excused,
            SUM(CASE WHEN a.status = 'Опоздал' THEN 1 ELSE 0 END) as late
        FROM attendance a
        JOIN schedule s ON a.schedule_id = s.id
        JOIN disciplines d ON s.discipline_id = d.id
        JOIN users u ON a.student_id = u.id
        WHERE s.teacher_id = %s 
          AND u.role = 'Студент'  -- Добавлено: только студенты
          AND s.lesson_date BETWEEN %s AND %s
        """
        
        params = [teacher_id, start_date, end_date]
        
        if student_id:
            query += " AND a.student_id = %s"
            params.append(student_id)
            query += " GROUP BY u.full_name, d.name"
        elif group_id:
            query += " AND s.group_id = %s"
            params.append(group_id)
            query += " GROUP BY u.full_name, d.name"
        
        statistics = db.execute_query(query, params)
    
    return render_template('teacher_statistics.html',
                         groups=groups,
                         students=students,
                         statistics=statistics,
                         start_date=start_date,
                         end_date=end_date,
                         selected_group=group_id,
                         selected_student=student_id)

# ========== МАРШРУТЫ ДЛЯ АДМИНИСТРАТОРА ==========

@app.route('/admin/users')
def admin_users():
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    role_filter = request.args.get('role', '')
    group_filter = request.args.get('group_id', '')
    search_query = request.args.get('search', '')
    
    query = """
    SELECT u.id, u.login, u.full_name, u.role, u.email, u.phone, 
           g.group_code
    FROM users u
    LEFT JOIN student_groups g ON u.group_id = g.id
    WHERE 1=1
    """
    
    params = []
    
    if role_filter:
        query += " AND u.role = %s"
        params.append(role_filter)
    
    if group_filter:
        query += " AND u.group_id = %s"
        params.append(group_filter)
    
    if search_query:
        query += " AND u.full_name ILIKE %s"
        params.append(f"%{search_query}%")
    
    query += " ORDER BY u.role, u.full_name"
    users = db.execute_query(query, params) if params else db.execute_query(query)
    
    # Получаем список групп для фильтра
    groups_query = "SELECT id, group_code FROM student_groups ORDER BY group_code"
    all_groups = db.execute_query(groups_query)

    now = datetime.now()
    current_time = now.strftime('%H:%M')
    
    return render_template('admin_users.html', 
                         users=users, 
                         role_filter=role_filter,
                         group_filter=group_filter,
                         search_query=search_query,
                         current_time=current_time,
                         all_groups=all_groups)

@app.route('/admin/user/add', methods=['GET', 'POST'])
def add_user():
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    if request.method == 'POST':
        login = request.form['login']
        password = request.form['password']
        full_name = request.form['full_name']
        role = request.form['role']
        email = request.form.get('email', '')
        phone = request.form.get('phone', '')
        group_id = request.form.get('group_id') if role == 'Студент' else None
        
        # Проверяем, существует ли пользователь с таким логином
        check_query = "SELECT id FROM users WHERE login = %s"
        existing = db.execute_query(check_query, (login,))
        
        if existing:
            flash('Пользователь с таким логином уже существует')
            return redirect(url_for('add_user'))
        
        query = """
        INSERT INTO users (login, password_hash, full_name, role, email, phone, group_id)
        VALUES (%s, %s, %s, %s, %s, %s, %s)
        """
        
        if db.execute_insert(query, (login, password, full_name, role, email, phone, group_id)):
            flash('Пользователь успешно добавлен')
            return redirect(url_for('admin_users'))
    
    # GET запрос - показываем форму
    groups_query = "SELECT id, group_code FROM student_groups ORDER BY group_code"
    groups = db.execute_query(groups_query)
    
    return render_template('add_user.html', groups=groups)

@app.route('/admin/user/edit/<int:user_id>', methods=['GET', 'POST'])
def edit_user(user_id):
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    if request.method == 'POST':
        login = request.form['login']
        full_name = request.form['full_name']
        role = request.form['role']
        email = request.form.get('email', '')
        phone = request.form.get('phone', '')
        group_id = request.form.get('group_id') if role == 'Студент' else None
        
        query = """
        UPDATE users 
        SET login = %s, full_name = %s, role = %s, email = %s, phone = %s, group_id = %s
        WHERE id = %s
        """
        
        if db.execute_insert(query, (login, full_name, role, email, phone, group_id, user_id)):
            flash('Пользователь успешно обновлен')
            return redirect(url_for('admin_users'))
    
    # GET запрос - получаем данные пользователя
    user_query = "SELECT login, full_name, role, email, phone, group_id FROM users WHERE id = %s"
    user_data = db.execute_query(user_query, (user_id,))
    
    if not user_data:
        flash('Пользователь не найден')
        return redirect(url_for('admin_users'))
    
    groups_query = "SELECT id, group_code FROM student_groups ORDER BY group_code"
    groups = db.execute_query(groups_query)
    
    return render_template('edit_user.html', 
                         user=user_data[0], 
                         user_id=user_id, 
                         groups=groups)

@app.route('/admin/user/delete/<int:user_id>', methods=['POST'])
def delete_user(user_id):
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    # Нельзя удалить самого себя
    if user_id == session['user_id']:
        flash('Нельзя удалить собственный аккаунт')
        return redirect(url_for('admin_users'))
    
    delete_query = "DELETE FROM users WHERE id = %s"
    if db.execute_insert(delete_query, (user_id,)):
        flash('Пользователь удален')
    
    return redirect(url_for('admin_users'))

@app.route('/admin/groups')
def admin_groups():
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    groups_query = """
    SELECT g.id, g.group_code, g.specialization, g.year_of_study,
           COUNT(DISTINCT u.id) as student_count
    FROM student_groups g
    LEFT JOIN users u ON g.id = u.group_id AND u.role = 'Студент'
    GROUP BY g.id, g.group_code, g.specialization, g.year_of_study
    ORDER BY g.group_code
    """
    
    groups = db.execute_query(groups_query)
    
    now = datetime.now()
    current_time = now.strftime('%H:%M')

    return render_template('admin_groups.html',
                           groups=groups,
                           current_time=current_time)

@app.route('/admin/schedule')
def admin_schedule():
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    # Получаем параметры фильтрации
    group_id = request.args.get('group_id')
    start_date = request.args.get('start_date')
    end_date = request.args.get('end_date')
    
    if not start_date:
        start_date = date.today()
    else:
        start_date = datetime.strptime(start_date, '%Y-%m-%d').date()
    
    if not end_date:
        end_date = start_date + timedelta(days=6)
    else:
        end_date = datetime.strptime(end_date, '%Y-%m-%d').date()
    
    # Получаем все группы
    groups_query = "SELECT id, group_code FROM student_groups ORDER BY group_code"
    groups = db.execute_query(groups_query)
    
    # Получаем расписание
    query = """
    SELECT s.id, d.name, s.lesson_date, s.lesson_time, s.classroom, 
           s.lesson_type, g.group_code, u.full_name as teacher_name
    FROM schedule s
    JOIN disciplines d ON s.discipline_id = d.id
    JOIN student_groups g ON s.group_id = g.id
    JOIN users u ON s.teacher_id = u.id
    WHERE s.lesson_date BETWEEN %s AND %s
    """
    
    params = [start_date, end_date]
    
    if group_id:
        query += " AND s.group_id = %s"
        params.append(group_id)
    
    query += " ORDER BY s.lesson_date, s.lesson_time, g.group_code"
    
    schedule = db.execute_query(query, params) if params else db.execute_query(query)
    
    # Группируем по дням
    schedule_by_day = {}
    for item in schedule:
        day = item[2]
        if day not in schedule_by_day:
            schedule_by_day[day] = []
        schedule_by_day[day].append(item)
    
    now = datetime.now()
    current_time = now.strftime('%H:%M')

    return render_template('admin_schedule.html',
                         schedule_by_day=schedule_by_day,
                         groups=groups,
                         start_date=start_date,
                         end_date=end_date,
                         current_time=current_time,
                         selected_group=group_id)

@app.route('/admin/schedule/add', methods=['GET', 'POST'])
def add_schedule():
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    if request.method == 'POST':
        discipline_id = request.form['discipline_id']
        group_id = request.form['group_id']
        teacher_id = request.form['teacher_id']
        lesson_date = request.form['lesson_date']
        lesson_time = request.form['lesson_time']
        classroom = request.form.get('classroom', '')
        lesson_type = request.form['lesson_type']
        
        # Проверяем, нет ли уже занятия в это время
        check_query = """
        SELECT id FROM schedule 
        WHERE group_id = %s AND lesson_date = %s AND lesson_time = %s
        """
        existing = db.execute_query(check_query, (group_id, lesson_date, lesson_time))
        
        if existing:
            flash('В это время у группы уже есть занятие')
            return redirect(url_for('add_schedule'))
        
        query = """
        INSERT INTO schedule (discipline_id, group_id, teacher_id, lesson_date, 
                             lesson_time, classroom, lesson_type)
        VALUES (%s, %s, %s, %s, %s, %s, %s)
        """
        
        if db.execute_insert(query, (discipline_id, group_id, teacher_id, lesson_date,
                                   lesson_time, classroom, lesson_type)):
            flash('Занятие добавлено в расписание')
            return redirect(url_for('admin_schedule'))
    
    # GET запрос - получаем данные для формы
    disciplines_query = "SELECT id, name FROM disciplines ORDER BY name"
    disciplines = db.execute_query(disciplines_query)
    
    groups_query = "SELECT id, group_code FROM student_groups ORDER BY group_code"
    groups = db.execute_query(groups_query)
    
    teachers_query = "SELECT id, full_name FROM users WHERE role = 'Преподаватель' ORDER BY full_name"
    teachers = db.execute_query(teachers_query)
    
    return render_template('add_schedule.html',
                         disciplines=disciplines,
                         groups=groups,
                         teachers=teachers)

@app.route('/admin/group/<int:group_id>/disciplines')
def group_disciplines(group_id):
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    # Получаем информацию о группе
    group_query = "SELECT group_code FROM student_groups WHERE id = %s"
    group_info = db.execute_query(group_query, (group_id,))
    if not group_info:
        flash('Группа не найдена')
        return redirect(url_for('admin_groups'))
    
    group_name = group_info[0][0]
    
    # Получаем дисциплины группы
    query = """
    SELECT d.id, d.name, d.description, d.total_hours, 
           u.full_name as teacher_name, gd.semester
    FROM group_disciplines gd
    JOIN disciplines d ON gd.discipline_id = d.id
    JOIN users u ON d.teacher_id = u.id
    WHERE gd.group_id = %s
    ORDER BY gd.semester, d.name
    """
    
    disciplines = db.execute_query(query, (group_id,))
    
    return render_template('group_disciplines.html',
                         disciplines=disciplines,
                         group_name=group_name,
                         group_id=group_id)

@app.route('/admin/statistics')
def admin_statistics():
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    # Получаем общую статистику
    stats_query = """
    SELECT 
        (SELECT COUNT(*) FROM users WHERE role = 'Студент') as student_count,
        (SELECT COUNT(*) FROM users WHERE role = 'Преподаватель') as teacher_count,
        (SELECT COUNT(*) FROM student_groups) as group_count,
        (SELECT COUNT(*) FROM disciplines) as discipline_count,
        (SELECT COUNT(*) FROM schedule WHERE lesson_date >= CURRENT_DATE - INTERVAL '7 days') as recent_classes,
        (SELECT COUNT(DISTINCT student_id) FROM attendance WHERE marked_at >= CURRENT_DATE - INTERVAL '7 days') as recent_attendance
    """
    stats = db.execute_query(stats_query)[0] if db.execute_query(stats_query) else (0, 0, 0, 0, 0, 0)
    
    # Статистика по посещаемости (ТОЛЬКО СТУДЕНТЫ)
    attendance_stats_query = """
    SELECT 
        ROUND(COUNT(CASE WHEN status = 'Присутствовал' THEN 1 END) * 100.0 / COUNT(*), 1) as attendance_percent,
        ROUND(COUNT(CASE WHEN status = 'Отсутствовал' THEN 1 END) * 100.0 / COUNT(*), 1) as absence_percent,
        ROUND(COUNT(CASE WHEN status = 'По уважительной причине' THEN 1 END) * 100.0 / COUNT(*), 1) as excused_percent,
        ROUND(COUNT(CASE WHEN status = 'Опоздал' THEN 1 END) * 100.0 / COUNT(*), 1) as late_percent
    FROM attendance a
    JOIN users u ON a.student_id = u.id
    WHERE u.role = 'Студент' AND a.marked_at >= CURRENT_DATE - INTERVAL '30 days'
    """
    attendance_stats = db.execute_query(attendance_stats_query)[0] if db.execute_query(attendance_stats_query) else (0, 0, 0, 0)
    
    # Топ групп по посещаемости (ТОЛЬКО СТУДЕНТЫ)
    top_groups_query = """
    SELECT g.group_code, 
           COUNT(*) as total_classes,
           ROUND(COUNT(CASE WHEN a.status = 'Присутствовал' THEN 1 END) * 100.0 / COUNT(*), 1) as attendance_rate
    FROM attendance a
    JOIN schedule s ON a.schedule_id = s.id
    JOIN student_groups g ON s.group_id = g.id
    JOIN users u ON a.student_id = u.id
    WHERE u.role = 'Студент' AND a.marked_at >= CURRENT_DATE - INTERVAL '30 days'
    GROUP BY g.id, g.group_code
    ORDER BY attendance_rate DESC
    LIMIT 5
    """
    top_groups = db.execute_query(top_groups_query) or []
    
    # Последние отметки посещаемости (ТОЛЬКО СТУДЕНТЫ)
    recent_attendance_query = """
    SELECT a.id, u.full_name, d.name, a.status, a.marked_at, g.group_code
    FROM attendance a
    JOIN users u ON a.student_id = u.id
    JOIN schedule s ON a.schedule_id = s.id
    JOIN disciplines d ON s.discipline_id = d.id
    JOIN student_groups g ON s.group_id = g.id
    WHERE u.role = 'Студент'
    ORDER BY a.marked_at DESC
    LIMIT 10
    """
    recent_attendance = db.execute_query(recent_attendance_query) or []
    
    now = datetime.now()
    current_time = now.strftime('%H:%M')

    return render_template('admin_statistics.html',
                         stats=stats,
                         attendance_stats=attendance_stats,
                         top_groups=top_groups,
                         recent_attendance=recent_attendance,
                         current_time = current_time)

# Добавление группы
@app.route('/admin/group/add', methods=['GET', 'POST'])
def add_group():
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    if request.method == 'POST':
        group_code = request.form['group_code']
        specialization = request.form.get('specialization', '')
        year_of_study = int(request.form['year_of_study'])
        
        # Проверяем, существует ли группа с таким кодом
        check_query = "SELECT id FROM student_groups WHERE group_code = %s"
        existing = db.execute_query(check_query, (group_code,))
        
        if existing:
            flash('Группа с таким кодом уже существует')
            return redirect(url_for('add_group'))
        
        query = """
        INSERT INTO student_groups (group_code, specialization, year_of_study)
        VALUES (%s, %s, %s)
        """
        
        if db.execute_insert(query, (group_code, specialization, year_of_study)):
            flash('Группа успешно создана')
            return redirect(url_for('admin_groups'))
    
    return render_template('add_group.html')

# Редактирование группы
@app.route('/admin/group/edit/<int:group_id>')
def edit_group(group_id):
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    # Получаем информацию о группе
    group_query = """
    SELECT id, group_code, specialization, year_of_study
    FROM student_groups 
    WHERE id = %s
    """
    group_data = db.execute_query(group_query, (group_id,))
    
    if not group_data:
        flash('Группа не найдена')
        return redirect(url_for('admin_groups'))
    
    return render_template('edit_group.html',
                         group=group_data[0])
# Обновление группы
@app.route('/admin/group/update/<int:group_id>', methods=['POST'])
def update_group(group_id):
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    group_code = request.form['group_code']
    specialization = request.form.get('specialization', '')
    year_of_study = int(request.form['year_of_study'])
    
    # Проверяем, не занят ли код группы другим группой
    check_query = "SELECT id FROM student_groups WHERE group_code = %s AND id != %s"
    existing = db.execute_query(check_query, (group_code, group_id))
    
    if existing:
        flash('Группа с таким кодом уже существует')
        return redirect(url_for('edit_group', group_id=group_id))
    
    update_query = """
    UPDATE student_groups 
    SET group_code = %s, specialization = %s, year_of_study = %s
    WHERE id = %s
    """
    
    if db.execute_insert(update_query, (group_code, specialization, year_of_study, group_id)):
        flash('Группа успешно обновлена')
    
    return redirect(url_for('edit_group', group_id=group_id))

# Удаление группы
@app.route('/admin/group/delete/<int:group_id>', methods=['POST'])
def delete_group(group_id):
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    # Удаляем группу (сработает CASCADE для студентов)
    delete_query = "DELETE FROM student_groups WHERE id = %s"
    
    if db.execute_insert(delete_query, (group_id,)):
        flash('Группа удалена')
    
    return redirect(url_for('admin_groups'))

# Добавление студента в группу
@app.route('/admin/group/<int:group_id>/add_student', methods=['POST'])
def add_student_to_group(group_id):
    if session.get('role') != 'Администратор':
        flash('Доступ запрещен')
        return redirect(url_for('dashboard'))
    
    full_name = request.form['full_name']
    login = request.form['login']
    password = request.form['password']
    
    # Проверяем, существует ли пользователь с таким логином
    check_query = "SELECT id FROM users WHERE login = %s"
    existing = db.execute_query(check_query, (login,))
    
    if existing:
        flash('Пользователь с таким логином уже существует')
        return redirect(url_for('edit_group', group_id=group_id))
    
    # Добавляем студента
    query = """
    INSERT INTO users (login, password_hash, full_name, role, group_id)
    VALUES (%s, %s, %s, 'Студент', %s)
    """
    
    if db.execute_insert(query, (login, password, full_name, group_id)):
        flash('Студент добавлен в группу')
    
    return redirect(url_for('edit_group', group_id=group_id))

# ========== ЗАПУСК ПРИЛОЖЕНИЯ ==========

if __name__ == '__main__':
    # Проверяем соединение с БД при запуске
    if not db.connect():
        print("Внимание: не удалось подключиться к базе данных!")
        print("Приложение будет работать с ограниченной функциональностью.")
    else:
        print("Соединение с базой данных установлено успешно!")
    
    app.run(debug=True, port=5001)

================================================================================
ФАЙЛ: read.py
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\read.py
РАЗМЕР: 3604 байт
================================================================================

import os
import sys

def save_files_with_content(directory, output_file='files_with_content.txt', 
                           max_file_size=1024*1024):  # 1MB по умолчанию
    """
    Сохраняет пути и содержимое текстовых файлов
    """
    text_extensions = {'.txt', '.py', '.html', '.css', '.js', '.json', '.xml', 
                      '.csv', '.md', '.yml', '.yaml', '.ini', '.cfg', '.conf'}
    
    directory = os.path.abspath(directory)
    
    with open(output_file, 'w', encoding='utf-8') as out_f:
        out_f.write(f"СКАНИРОВАНИЕ ДИРЕКТОРИИ: {directory}\n")
        out_f.write("=" * 100 + "\n\n")
        
        total_files = 0
        scanned_files = 0
        
        for root, dirs, files in os.walk(directory):
            # Пропускаем служебные папки
            dirs[:] = [d for d in dirs if d not in {'.git', '__pycache__', 'node_modules', 'venv'}]
            
            for file in files:
                total_files += 1
                file_path = os.path.join(root, file)
                rel_path = os.path.relpath(file_path, directory)
                
                # Пропускаем бинарные и большие файлы
                ext = os.path.splitext(file)[1].lower()
                if ext not in text_extensions:
                    continue
                
                try:
                    file_size = os.path.getsize(file_path)
                    if file_size > max_file_size:
                        out_f.write(f"\nФАЙЛ: {rel_path}\n")
                        out_f.write(f"РАЗМЕР: {file_size} байт (пропущен - слишком большой)\n")
                        out_f.write("-" * 80 + "\n\n")
                        continue
                    
                    out_f.write(f"\n{'='*80}\n")
                    out_f.write(f"ФАЙЛ: {rel_path}\n")
                    out_f.write(f"ПОЛНЫЙ ПУТЬ: {file_path}\n")
                    out_f.write(f"РАЗМЕР: {file_size} байт\n")
                    out_f.write(f"{'='*80}\n\n")
                    
                    try:
                        with open(file_path, 'r', encoding='utf-8') as in_f:
                            content = in_f.read()
                            out_f.write(content)
                            if not content.endswith('\n'):
                                out_f.write('\n')
                    except UnicodeDecodeError:
                        out_f.write("[Бинарный файл или неизвестная кодировка]\n")
                    except Exception as e:
                        out_f.write(f"[Ошибка чтения: {str(e)}]\n")
                    
                    scanned_files += 1
                    
                except Exception as e:
                    out_f.write(f"\nОШИБКА при обработке {rel_path}: {str(e)}\n")
    
    print(f"✓ Всего файлов в директории: {total_files}")
    print(f"✓ Обработано текстовых файлов: {scanned_files}")
    print(f"✓ Результат сохранен в: {output_file}")

if __name__ == "__main__":
    # Использование
    if len(sys.argv) > 1:
        directory = sys.argv[1]
    else:
        directory = input("Введите путь к директории: ").strip() or "."
    
    save_files_with_content(directory, 'directory_contents.txt')

================================================================================
ФАЙЛ: Создание БД.txt
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\Создание БД.txt
РАЗМЕР: 4978 байт
================================================================================

DROP TABLE IF EXISTS attendance CASCADE;
DROP TABLE IF EXISTS schedule CASCADE;
DROP TABLE IF EXISTS group_disciplines CASCADE;
DROP TABLE IF EXISTS disciplines CASCADE;
DROP TABLE IF EXISTS student_groups CASCADE;
DROP TABLE IF EXISTS users CASCADE;

CREATE TABLE users(
    id BIGSERIAL PRIMARY KEY,
    login TEXT NOT NULL UNIQUE CHECK (char_length(login) >= 3),
    password_hash TEXT NOT NULL CHECK (char_length(password_hash) >= 3),
    full_name TEXT NOT NULL CHECK (char_length(full_name) >= 2),
    role TEXT NOT NULL CHECK (role IN ('Студент', 'Преподаватель', 'Администратор')),
    email TEXT,
    phone TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE student_groups(
    id BIGSERIAL PRIMARY KEY,
    group_code TEXT NOT NULL UNIQUE,
    specialization TEXT,
    year_of_study INTEGER CHECK (year_of_study >= 1 AND year_of_study <= 6),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Обновляем таблицу users, чтобы добавить ссылку на группу для студентов
ALTER TABLE users ADD COLUMN IF NOT EXISTS group_id BIGINT REFERENCES student_groups(id) ON DELETE SET NULL;

CREATE TABLE disciplines(
    id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    total_hours INTEGER NOT NULL CHECK (total_hours > 0),
    teacher_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE group_disciplines(
    id BIGSERIAL PRIMARY KEY,
    group_id BIGINT NOT NULL REFERENCES student_groups(id) ON DELETE CASCADE,
    discipline_id BIGINT NOT NULL REFERENCES disciplines(id) ON DELETE CASCADE,
    semester INTEGER CHECK (semester >= 1 AND semester <= 12),
    UNIQUE(group_id, discipline_id)
);

CREATE TABLE schedule(
    id BIGSERIAL PRIMARY KEY,
    discipline_id BIGINT NOT NULL REFERENCES disciplines(id) ON DELETE CASCADE,
    group_id BIGINT NOT NULL REFERENCES student_groups(id) ON DELETE CASCADE,
    teacher_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    lesson_date DATE NOT NULL,
    lesson_time TIME NOT NULL,
    classroom TEXT,
    lesson_type TEXT CHECK (lesson_type IN ('Лекция', 'Практика', 'Лабораторная', 'Семинар')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE attendance(
    id BIGSERIAL PRIMARY KEY,
    student_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    schedule_id BIGINT NOT NULL REFERENCES schedule(id) ON DELETE CASCADE,
    status TEXT NOT NULL CHECK (status IN ('Присутствовал', 'Отсутствовал', 'По уважительной причине', 'Опоздал')),
    notes TEXT,
    marked_by BIGINT REFERENCES users(id) ON DELETE SET NULL,
    marked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(student_id, schedule_id)
);

-- Индексы для оптимизации запросов
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_users_group ON users(group_id);
CREATE INDEX idx_disciplines_teacher ON disciplines(teacher_id);
CREATE INDEX idx_schedule_date ON schedule(lesson_date);
CREATE INDEX idx_schedule_group_date ON schedule(group_id, lesson_date);
CREATE INDEX idx_attendance_student_date ON attendance(student_id, marked_at);
CREATE INDEX idx_attendance_schedule ON attendance(schedule_id);

-- Тестовые данные
INSERT INTO student_groups (group_code, specialization, year_of_study) VALUES
('ИВТ-101', 'Информатика и вычислительная техника', 1),
('ИВТ-201', 'Информатика и вычислительная техника', 2),
('ПИ-101', 'Прикладная информатика', 1);

-- Администратор по умолчанию
INSERT INTO users (login, password_hash, full_name, role, email) VALUES
('admin', 'admin123', 'Администратор Системы', 'Администратор', 'admin@university.ru'),
('teacher1', 'teacher123', 'Иванова Мария Петровна', 'Преподаватель', 'ivanova@university.ru'),
('teacher2', 'teacher123', 'Петров Алексей Сергеевич', 'Преподаватель', 'petrov@university.ru');

-- Тестовые студенты
INSERT INTO users (login, password_hash, full_name, role, email, group_id) VALUES
('student1', 'student123', 'Сидоров Иван Алексеевич', 'Студент', 'sidorov@university.ru', 1),
('student2', 'student123', 'Козлова Анна Сергеевна', 'Студент', 'kozlova@university.ru', 1),
('student3', 'student123', 'Михайлов Дмитрий Петрович', 'Студент', 'mikhaylov@university.ru', 2),
('student4', 'student123', 'Смирнова Елена Владимировна', 'Студент', 'smirnova@university.ru', 2);

================================================================================
ФАЙЛ: .pytest_cache\README.md
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\.pytest_cache\README.md
РАЗМЕР: 310 байт
================================================================================

# pytest cache directory #

This directory contains data from the pytest's cache plugin,
which provides the `--lf` and `--ff` options, as well as the `cache` fixture.

**Do not** commit this to version control.

See [the docs](https://docs.pytest.org/en/stable/how-to/cache.html) for more information.

================================================================================
ФАЙЛ: templates\add_discipline.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\add_discipline.html
РАЗМЕР: 15810 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Добавить дисциплину</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
    .border-danger {
        border: 2px solid #dc3545 !important;
        background-color: #fff5f5 !important;
    }

    .group-checkbox:checked + .form-check-label {
        color: #198754 !important;
        font-weight: bold !important;
    }

    .semester-input {
        transition: all 0.3s ease;
    }

    .semester-input:focus {
        border-color: #20c997;
        box-shadow: 0 0 0 0.25rem rgba(32, 201, 151, 0.25);
    }
    .is-valid {
    border-color: #198754 !important;
    background-color: #d4edda !important;
    }

    .is-invalid {
        border-color: #dc3545 !important;
        background-color: #f8d7da !important;
    }

    .form-check-label {
        font-weight: 500;
    }

    .border {
        border: 1px solid #dee2e6;
        border-radius: 8px;
    }
    .btn-back-teacher {
        background-color: #198754;
        color: white;
        border: 2px solid #198754;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s;
    }
    .btn-back-teacher:hover {
        background-color: #157347;
        border-color: #146c43;
        transform: scale(1.05);
        color: white;
    }
    .btn-back-teacher {
        background-color: #198754;
        color: white;
        border: 2px solid #198754;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s;
    }
    .btn-back-teacher:hover {
        background-color: #157347;
        border-color: #146c43;
        transform: scale(1.05);
        color: white;
    }
    
    /* ЦВЕТА ФОРМЫ */
    .card-header {
        background: linear-gradient(135deg, #198754 0%, #146c43 100%);
    }
    .form-control:focus {
        border-color: #20c997;
        box-shadow: 0 0 0 0.25rem rgba(32, 201, 151, 0.25);
    }
    .btn-success {
        background-color: #198754;
        border-color: #198754;
    }
    .btn-success:hover {
        background-color: #157347;
        border-color: #146c43;
    }
    .border {
        border-color: #c3e6cb !important;
    }   
</style>
</head>
<body>
    <nav class="navbar navbar-dark bg-success shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <a href="{{ url_for('dashboard') }}" class="btn btn-back-teacher">
                    <i class="bi bi-arrow-left-circle"></i> Назад в панель
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="bi bi-plus-circle"></i> Добавить новую дисциплину</h4>
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                                <div class="alert alert-warning">
                                    {% for message in messages %}
                                        <div>{{ message }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endwith %}

                        <form method="POST">
                            <div class="mb-3">
                                <label class="form-label">Название дисциплины *</label>
                                <input type="text" class="form-control" name="name" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Описание</label>
                                <textarea class="form-control" name="description" rows="3"></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Общее количество часов *</label>
                                <input type="number" class="form-control" name="total_hours" min="1" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Группы для дисциплины *</label>
                                <div class="border p-3 bg-light">
                                    {% if groups %}
                                        {% for group in groups %}
                                        <div class="form-check mb-2">
                                            <input class="form-check-input group-checkbox" type="checkbox" 
                                                name="groups" value="{{ group[0] }}" id="group{{ group[0] }}">
                                            <label class="form-check-label" for="group{{ group[0] }}">
                                                {{ group[1] }}
                                            </label>
                                            <input type="number" class="form-control form-control-sm mt-1 semester-input" 
                                                name="semester_{{ group[0] }}" 
                                                placeholder="Семестр (1-12)" 
                                                min="1" max="12" 
                                                style="width: 140px;"
                                                data-group="{{ group[0] }}">
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="alert alert-warning">
                                            <i class="bi bi-exclamation-triangle"></i> Нет доступных групп
                                        </div>
                                    {% endif %}
                                </div>
                                <small class="text-muted">Выберите одну или несколько групп, которые будут изучать эту дисциплину</small>
                                <div class="text-muted mt-1">
                                    <small><i class="bi bi-info-circle"></i> Для каждой выбранной группы укажите семестр (от 1 до 12)</small>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-save"></i> Сохранить дисциплину
                                </button>
                                <a href="{{ url_for('teacher_disciplines') }}" class="btn btn-secondary">Отмена</a>
                            </div>

                            <div class="mt-4 text-center">
                                <p class="text-muted">
                                    После создания дисциплины вы сможете управлять группами через меню 
                                    <i class="bi bi-people"></i> "Управление группами" в списке дисциплин
                                </p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const checkboxes = document.querySelectorAll('.group-checkbox');
        const semesterInputs = document.querySelectorAll('.semester-input');
        const groupsContainer = document.querySelector('.border');
        
        // Динамически добавляем атрибут required только если группа выбрана
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const groupId = this.value;
                const semesterInput = document.querySelector(`.semester-input[data-group="${groupId}"]`);
                
                if (this.checked) {
                    semesterInput.style.display = 'block';
                    semesterInput.required = true;
                    // Добавляем стиль для выбранной группы
                    const label = document.querySelector(`label[for="group${groupId}"]`);
                    label.classList.add('text-success', 'fw-bold');
                } else {
                    semesterInput.style.display = 'none';
                    semesterInput.required = false;
                    semesterInput.value = '';
                    // Убираем стиль
                    const label = document.querySelector(`label[for="group${groupId}"]`);
                    label.classList.remove('text-success', 'fw-bold');
                }
            });
        });
        
        // Изначально скрываем все поля семестров
        semesterInputs.forEach(input => {
            input.style.display = 'none';
            input.required = false;
        });
        
        // Валидация формы при отправке
        form.addEventListener('submit', function(event) {
            let selectedGroups = [];
            let allSemestersValid = true;
            let errorMessages = [];
            
            // Собираем выбранные группы
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedGroups.push(checkbox.value);
                }
            });
            
            // Проверка 1: выбрана ли хотя бы одна группа
            if (selectedGroups.length === 0) {
                errorMessages.push('Пожалуйста, выберите хотя бы одну группу для дисциплины');
                // Добавляем красную рамку ко всему блоку групп
                groupsContainer.classList.add('border-danger');
            } else {
                groupsContainer.classList.remove('border-danger');
            }
            
            // Проверка 2: корректность семестров для выбранных групп
            selectedGroups.forEach(groupId => {
                const semesterInput = document.querySelector(`.semester-input[data-group="${groupId}"]`);
                const semesterValue = semesterInput.value.trim();
                
                if (!semesterValue) {
                    errorMessages.push(`Для группы "${document.querySelector(`label[for="group${groupId}"]`).textContent.trim()}" не указан семестр`);
                    semesterInput.classList.add('is-invalid');
                    allSemestersValid = false;
                } else if (parseInt(semesterValue) < 1 || parseInt(semesterValue) > 12) {
                    errorMessages.push(`Для группы "${document.querySelector(`label[for="group${groupId}"]`).textContent.trim()}" указан некорректный семестр (должен быть от 1 до 12)`);
                    semesterInput.classList.add('is-invalid');
                    allSemestersValid = false;
                } else {
                    semesterInput.classList.remove('is-invalid');
                    semesterInput.classList.add('is-valid');
                }
            });
            
            // Если есть ошибки, предотвращаем отправку и показываем их
            if (errorMessages.length > 0) {
                event.preventDefault();
                
                // Создаем красивый alert с ошибками
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-danger mt-3';
                alertDiv.innerHTML = `
                    <h5><i class="bi bi-exclamation-triangle"></i> Ошибки в форме:</h5>
                    <ul class="mb-0">
                        ${errorMessages.map(msg => `<li>${msg}</li>`).join('')}
                    </ul>
                `;
                
                // Удаляем предыдущие сообщения об ошибках
                const existingAlert = document.querySelector('.alert-danger');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // Вставляем новое сообщение перед формой
                form.parentNode.insertBefore(alertDiv, form);
                
                // Прокручиваем к ошибкам
                alertDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                return false;
            }
            
            // Все проверки пройдены
            return true;
        });
        
        // Динамическая валидация семестров при вводе
        semesterInputs.forEach(input => {
            input.addEventListener('input', function() {
                const value = parseInt(this.value);
                if (value < 1 || value > 12) {
                    this.classList.add('is-invalid');
                    this.classList.remove('is-valid');
                } else {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                }
            });
        });
        
        // Валидация при потере фокуса
        semesterInputs.forEach(input => {
            input.addEventListener('blur', function() {
                if (this.value && this.required) {
                    const value = parseInt(this.value);
                    if (value < 1 || value > 12) {
                        this.classList.add('is-invalid');
                        this.classList.remove('is-valid');
                    } else {
                        this.classList.remove('is-invalid');
                        this.classList.add('is-valid');
                    }
                }
            });
        });
        
        checkboxes.forEach(checkbox => {
            checkbox.required = false;
        });
    });
</script>
</body>
</html>

================================================================================
ФАЙЛ: templates\add_group.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\add_group.html
РАЗМЕР: 4715 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Добавить группу</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
    .btn-back {
        background-color: #dc3545;
        color: white;
        border: 2px solid #dc3545;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s;
    }
    .btn-back:hover {
        background-color: #c82333;
        border-color: #bd2130;
        transform: scale(1.05);
        color: white;
    }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-danger">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <a href="{{ url_for('dashboard') }}" class="btn btn-back">
                    <i class="bi bi-arrow-left-circle"></i> Назад в панель
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-danger text-white">
                        <h4 class="mb-0"><i class="bi bi-plus-circle"></i> Добавить новую группу</h4>
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                                <div class="alert alert-warning">
                                    {% for message in messages %}
                                        <div>{{ message }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endwith %}

                        <form method="POST">
                            <div class="mb-3">
                                <label class="form-label">Код группы *</label>
                                <input type="text" class="form-control" name="group_code" 
                                       placeholder="Например: ИВТ-101" required>
                                <small class="text-muted">Уникальный код группы</small>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Специализация</label>
                                <input type="text" class="form-control" name="specialization" 
                                       placeholder="Например: Информатика и вычислительная техника">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Курс *</label>
                                <select class="form-select" name="year_of_study" required>
                                    <option value="">Выберите курс</option>
                                    <option value="1">1 курс</option>
                                    <option value="2">2 курс</option>
                                    <option value="3">3 курс</option>
                                    <option value="4">4 курс</option>
                                    <option value="5">5 курс</option>
                                    <option value="6">6 курс</option>
                                </select>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-danger">
                                    <i class="bi bi-save"></i> Создать группу
                                </button>
                                <a href="{{ url_for('admin_groups') }}" class="btn btn-secondary">Отмена</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

================================================================================
ФАЙЛ: templates\add_schedule.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\add_schedule.html
РАЗМЕР: 6919 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Добавить в расписание</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
<style>
    .btn-back {
        background-color: #dc3545;
        color: white;
        border: 2px solid #dc3545;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s;
    }
    .btn-back:hover {
        background-color: #c82333;
        border-color: #bd2130;
        transform: scale(1.05);
        color: white;
    }
</style>
</head>
<body>
    <nav class="navbar navbar-dark bg-danger">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <a href="{{ url_for('dashboard') }}" class="btn btn-back">
                    <i class="bi bi-arrow-left-circle"></i> Назад в панель
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-danger text-white">
                        <h4 class="mb-0"><i class="bi bi-calendar-plus"></i> Добавить занятие в расписание</h4>
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                                <div class="alert alert-warning">
                                    {% for message in messages %}
                                        <div>{{ message }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endwith %}

                        <form method="POST">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Дисциплина *</label>
                                    <select class="form-select" name="discipline_id" required>
                                        <option value="">Выберите дисциплину</option>
                                        {% for disc in disciplines %}
                                        <option value="{{ disc[0] }}">{{ disc[1] }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Группа *</label>
                                    <select class="form-select" name="group_id" required>
                                        <option value="">Выберите группу</option>
                                        {% for group in groups %}
                                        <option value="{{ group[0] }}">{{ group[1] }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Преподаватель *</label>
                                    <select class="form-select" name="teacher_id" required>
                                        <option value="">Выберите преподавателя</option>
                                        {% for teacher in teachers %}
                                        <option value="{{ teacher[0] }}">{{ teacher[1] }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Дата занятия *</label>
                                    <input type="date" class="form-control" name="lesson_date" required>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Время начала *</label>
                                    <input type="time" class="form-control" name="lesson_time" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Тип занятия *</label>
                                    <select class="form-select" name="lesson_type" required>
                                        <option value="Лекция">Лекция</option>
                                        <option value="Практика">Практика</option>
                                        <option value="Лабораторная">Лабораторная</option>
                                        <option value="Семинар">Семинар</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Аудитория</label>
                                <input type="text" class="form-control" name="classroom" placeholder="Например: 301">
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-danger">
                                    <i class="bi bi-save"></i> Добавить в расписание
                                </button>
                                <a href="{{ url_for('admin_schedule') }}" class="btn btn-secondary">Отмена</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

================================================================================
ФАЙЛ: templates\add_user.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\add_user.html
РАЗМЕР: 6523 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Добавить пользователя</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
<style>
    .btn-back {
        background-color: #dc3545;
        color: white;
        border: 2px solid #dc3545;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s;
    }
    .btn-back:hover {
        background-color: #c82333;
        border-color: #bd2130;
        transform: scale(1.05);
        color: white;
    }
</style>
</head>
<body>
    <nav class="navbar navbar-dark bg-danger">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <a href="{{ url_for('dashboard') }}" class="btn btn-back">
                    <i class="bi bi-arrow-left-circle"></i> Назад в панель
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-danger text-white">
                        <h4 class="mb-0"><i class="bi bi-person-plus"></i> Добавить нового пользователя</h4>
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                                <div class="alert alert-warning">
                                    {% for message in messages %}
                                        <div>{{ message }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endwith %}

                        <form method="POST">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Логин *</label>
                                    <input type="text" class="form-control" name="login" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Пароль *</label>
                                    <input type="password" class="form-control" name="password" required>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">ФИО *</label>
                                    <input type="text" class="form-control" name="full_name" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Роль *</label>
                                    <select class="form-select" name="role" id="roleSelect" required>
                                        <option value="">Выберите роль</option>
                                        <option value="Студент">Студент</option>
                                        <option value="Преподаватель">Преподаватель</option>
                                        <option value="Администратор">Администратор</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" name="email">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Телефон</label>
                                    <input type="tel" class="form-control" name="phone">
                                </div>
                            </div>
                            
                            <div class="mb-3" id="groupField" style="display: none;">
                                <label class="form-label">Группа (только для студентов)</label>
                                <select class="form-select" name="group_id">
                                    <option value="">Выберите группу</option>
                                    {% for group in groups %}
                                    <option value="{{ group[0] }}">{{ group[1] }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-danger">
                                    <i class="bi bi-save"></i> Сохранить пользователя
                                </button>
                                <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">Отмена</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('roleSelect').addEventListener('change', function() {
            var groupField = document.getElementById('groupField');
            if (this.value === 'Студент') {
                groupField.style.display = 'block';
            } else {
                groupField.style.display = 'none';
            }
        });
    </script>
</body>
</html>

================================================================================
ФАЙЛ: templates\admin_dashboard.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\admin_dashboard.html
РАЗМЕР: 13458 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Панель администратора</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        body { background-color: #f8f9fa; }
        .stat-card { border-radius: 10px; transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-5px); }
        
        /* ИСПРАВЛЕНИЕ: Активные элементы в красный цвет */
        .list-group-item.active { 
            background-color: #dc3545 !important; 
            color: white !important; 
            border-color: rgb(63, 74, 228) !important;
        }
        
        /* Исправление для предотвращения переноса */
        .navbar-nav {
            flex-wrap: nowrap;
        }
        .nav-link {
            white-space: nowrap;
        }
        
        /* Для мобильных устройств */
        @media (max-width: 768px) {
            .navbar-brand {
                font-size: 1rem;
            }
            .nav-link {
                font-size: 0.9rem;
                padding: 0.5rem;
            }
        }
        
        /* Дополнительный красный цвет для админки */
        .sidebar-menu .card-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        /* Быстрые действия тоже в красный */
        .quick-actions-card .card-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <div class="d-flex">
                    <span class="nav-item nav-link text-white" style="white-space: nowrap;">
                        <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                    </span>
                    <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}" style="white-space: nowrap;">
                        <i class="bi bi-box-arrow-right"></i> Выход
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню - САЙДБАР -->
            <div class="col-md-3">
                <!-- Блок администрирования -->
                <div class="card mb-4 sidebar-menu">
                    <div class="card-header bg-danger text-white">
                        <i class="bi bi-menu-button"></i> Администрирование
                    </div>
                    <div class="list-group list-group-flush">
                    <!-- Текущая страница - активная -->
                    <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action active">
                        <i class="bi bi-speedometer2"></i> Панель управления
                    </a>
                    
                    <!-- Управление пользователями -->
                    <a href="{{ url_for('admin_users') }}" class="list-group-item list-group-item-action">
                        <i class="bi bi-people"></i> Пользователи
                    </a>
                    
                    <!-- Управление группами -->
                    <a href="{{ url_for('admin_groups') }}" class="list-group-item list-group-item-action">
                        <i class="bi bi-collection"></i> Группы
                    </a>
                    
                    <!-- Управление расписанием -->
                    <a href="{{ url_for('admin_schedule') }}" class="list-group-item list-group-item-action">
                        <i class="bi bi-calendar-week"></i> Расписание
                    </a>
                    
                    <!-- Статистика системы -->
                    <a href="{{ url_for('admin_statistics') }}" class="list-group-item list-group-item-action">
                        <i class="bi bi-bar-chart"></i> Статистика
                    </a>
                </div>
                </div>

                <!-- Быстрые действия -->
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <i class="bi bi-lightning"></i> Быстрые действия
                    </div>
                    <div class="card-body">
                        <!-- Добавление пользователя -->
                        <a href="{{ url_for('add_user') }}" class="btn btn-danger btn-sm w-100 mb-2">
                            <i class="bi bi-person-plus"></i> Добавить пользователя
                        </a>
                        
                        <!-- Добавление в расписание -->
                        <a href="{{ url_for('add_schedule') }}" class="btn btn-warning btn-sm w-100 mb-2">
                            <i class="bi bi-calendar-plus"></i> Добавить в расписание
                        </a>
                        
                        <!-- Просмотр расписания -->
                        <a href="{{ url_for('admin_schedule') }}" class="btn btn-info btn-sm w-100 mb-2">
                            <i class="bi bi-eye"></i> Просмотр расписания
                        </a>
                        
                        <!-- НОВАЯ КНОПКА: Просмотр статистики -->
                        <a href="{{ url_for('admin_statistics') }}" class="btn btn-success btn-sm w-100">
                            <i class="bi bi-graph-up"></i> Просмотр статистики
                        </a>
                    </div>
                </div>
                
                <!-- Информация о системе -->
                <div class="card mt-4">
                    <div class="card-header bg-secondary text-white">
                        <i class="bi bi-info-circle"></i> Информация о системе
                    </div>
                    <div class="card-body">
                        <small class="text-muted">
                            <div class="mb-1"><strong>Роль:</strong> Администратор</div>
                            <div class="mb-1"><strong>Вход:</strong> {{ session['login'] }}</div>
                            <div><strong>Время:</strong> {{ now.strftime('%H:%M') if now else '' }}</div>
                        </small>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <!-- Заголовок и дата -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3><i class="bi bi-speedometer2"></i> Панель администратора</h3>
                    <span class="badge bg-danger">{{ today_date.strftime('%d.%m.%Y') }}</span>
                </div>

                <!-- Карточки статистики -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card bg-primary text-white">
                            <div class="card-body text-center">
                                <h1 class="display-4">{{ stats[0] }}</h1>
                                <p class="mb-0"><i class="bi bi-people"></i> Студентов</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card bg-success text-white">
                            <div class="card-body text-center">
                                <h1 class="display-4">{{ stats[1] }}</h1>
                                <p class="mb-0"><i class="bi bi-person"></i> Преподавателей</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card bg-info text-white">
                            <div class="card-body text-center">
                                <h1 class="display-4">{{ stats[2] }}</h1>
                                <p class="mb-0"><i class="bi bi-collection"></i> Групп</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card bg-warning text-dark">
                            <div class="card-body text-center">
                                <h1 class="display-4">{{ stats[3] }}</h1>
                                <p class="mb-0"><i class="bi bi-book"></i> Дисциплин</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Сегодняшнее расписание -->
                <div class="card mb-4">
                    <div class="card-header bg-danger text-white d-flex justify-content-between">
                        <h5 class="mb-0"><i class="bi bi-calendar-day"></i> Расписание на сегодня</h5>
                        <span class="badge bg-light text-dark">{{ today_date.strftime('%d.%m.%Y') }}</span>
                    </div>
                    <div class="card-body">
                        {% if today_schedule %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Время</th>
                                            <th>Дисциплина</th>
                                            <th>Группа</th>
                                            <th>Аудитория</th>
                                            <th>Преподаватель</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for lesson in today_schedule %}
                                        <tr>
                                            <td><strong>{{ lesson[2] }}</strong></td>
                                            <td>{{ lesson[1] }}</td>
                                            <td><span class="badge bg-primary">{{ lesson[5] }}</span></td>
                                            <td>{{ lesson[3] }}</td>
                                            <td>{{ lesson[6] }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> На сегодня занятий нет
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Небольшой скрипт для обновления времени -->
    <script>
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            const timeElement = document.querySelector('.card-body small div:last-child');
            if (timeElement) {
                timeElement.innerHTML = `<strong>Время:</strong> ${timeString}`;
            }
        }
        
        // Обновляем время каждую минуту
        setInterval(updateTime, 60000);
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
        });
    </script>
</body>
</html>

================================================================================
ФАЙЛ: templates\admin_groups.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\admin_groups.html
РАЗМЕР: 16359 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Управление группами</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        /* Существующие стили */
        .group-card { transition: transform 0.2s; }
        .group-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .student-count { font-size: 2rem; font-weight: bold; }
        .specialization-badge { font-size: 0.75rem; }
        .btn-add-floating {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
        }
        .btn-add-floating:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }
        .btn-add-floating.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }
        
        /* Стили для боковой панели */
        body { background-color: #f8f9fa; }
        .sidebar-menu { 
            position: sticky; 
            top: 20px; 
        }
        .list-group-item.active { 
            background-color: #dc3545 !important; 
            color: white !important; 
        }
        .quick-actions-card .card-header {
            background: linear-gradient(#ffc107);
        }
        .quick-actions-card .btn-add-group {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }
        .quick-actions-card .btn-add-group:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
        .card-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        .system-info-card .card-header {
            background: linear-gradient(135deg, #6c757d 0%, #6c757d 100%);
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <!-- Блок администрирования -->
                <div class="card mb-4 sidebar-menu">
                    <div class="card-header bg-danger text-white">
                        <i class="bi bi-menu-button"></i> Администрирование
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-speedometer2"></i> Панель управления
                        </a>
                        <a href="{{ url_for('admin_users') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-people"></i> Пользователи
                        </a>
                        <a href="{{ url_for('admin_groups') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-collection"></i> Группы
                        </a>
                        <a href="{{ url_for('admin_schedule') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-calendar-week"></i> Расписание
                        </a>
                        <a href="{{ url_for('admin_statistics') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-bar-chart"></i> Статистика
                        </a>
                    </div>
                </div>

                <!-- Быстрые действия -->
                <div class="card quick-actions-card">
                    <div class="card-header bg-warning text-dark">
                        <i class="bi bi-lightning"></i> Быстрые действия
                    </div>
                    <div class="card-body">
                        <!-- Добавление группы -->
                        <a href="{{ url_for('add_group') }}" class="btn btn-add-group btn-sm w-100 mb-2">
                            <i class="bi bi-plus-circle"></i> Добавить группу
                        </a>
                        
                        <!-- Добавление в расписание -->
                        <a href="{{ url_for('add_schedule') }}" class="btn btn-warning btn-sm w-100 mb-2">
                            <i class="bi bi-calendar-plus"></i> Добавить в расписание
                        </a>
                        
                        <!-- Просмотр пользователей -->
                        <a href="{{ url_for('admin_users') }}" class="btn btn-info btn-sm w-100 mb-2">
                            <i class="bi bi-eye"></i> Просмотр пользователей
                        </a>
                        
                        <!-- Просмотр статистики -->
                        <a href="{{ url_for('admin_statistics') }}" class="btn btn-success btn-sm w-100">
                            <i class="bi bi-graph-up"></i> Просмотр статистики
                        </a>
                    </div>
                </div>
                
                <!-- Информация о системе -->
                <div class="card mt-4 system-info-card">
                    <div class="card-header bg-secondary text-white">
                        <i class="bi bi-info-circle"></i> Информация о системе
                    </div>
                    <div class="card-body">
                        <small class="text-muted">
                            <div class="mb-1"><strong>Роль:</strong> Администратор</div>
                            <div class="mb-1"><strong>Вход:</strong> {{ session['login'] }}</div>
                            <div><strong>Время:</strong> {{ current_time if current_time else '' }}</div>
                        </small>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="bi bi-collection"></i> Управление группами</h2>
                </div>
                
                {% if groups %}
                    <div class="row">
                        {% for group in groups %}
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card group-card h-100">
                                <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
                                    <div>
                                        <h5 class="mb-0">{{ group[1] }}</h5>
                                        {% if group[2] %}
                                        <small class="specialization-badge">{{ group[2] }}</small>
                                        {% endif %}
                                    </div>
                                    <span class="badge bg-light text-dark">{{ group[3] }} курс</span>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="me-3">
                                            <i class="bi bi-people" style="font-size: 2rem; color: #6c757d;"></i>
                                        </div>
                                        <div>
                                            <div class="student-count">{{ group[4] }}</div>
                                            <div class="text-muted">студентов</div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <small class="text-muted">Специализация:</small>
                                        <div>{{ group[2] or 'Не указана' }}</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <small class="text-muted">Курс:</small>
                                        <div>{{ group[3] }}</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <small class="text-muted">Код группы:</small>
                                        <div><code>{{ group[1] }}</code></div>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent border-top">
                                    <div class="d-flex justify-content-between">
                                        <!-- Кнопка просмотра студентов группы -->
                                        <a href="{{ url_for('admin_users') }}?role=Студент&group_id={{ group[0] }}" 
                                           class="btn btn-sm btn-outline-primary" 
                                           title="Просмотр студентов группы">
                                            <i class="bi bi-people"></i> Студенты
                                        </a>
                                        
                                        <!-- Кнопка просмотра расписания группы -->
                                        <a href="{{ url_for('admin_schedule') }}?group_id={{ group[0] }}" 
                                           class="btn btn-sm btn-outline-info" 
                                           title="Расписание группы">
                                            <i class="bi bi-calendar-week"></i> Расписание
                                        </a>
                                        
                                        <!-- Кнопка просмотра дисциплин группы -->
                                        <a href="{{ url_for('group_disciplines', group_id=group[0]) }}" 
                                           class="btn btn-sm btn-outline-success" 
                                           title="Дисциплины группы">
                                            <i class="bi bi-book"></i> Дисциплины
                                        </a>
                                    </div>
                                    
                                    <!-- Кнопка управления группой -->
                                    <div class="mt-2 text-center">
                                        <a href="{{ url_for('edit_group', group_id=group[0]) }}" 
                                           class="btn btn-sm btn-warning">
                                            <i class="bi bi-gear"></i> Управление группой
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Общая статистика по группам -->
                    <div class="card mt-4">
                        <div class="card-header bg-secondary text-white">
                            <i class="bi bi-graph-up"></i> Общая статистика по группам
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-md-6 mb-3">
                                    <div class="display-6 text-primary">{{ groups|length }}</div>
                                    <div class="text-muted">Всего групп</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    {% set total_students = groups|sum(attribute='4') %}
                                    <div class="display-6 text-success">{{ total_students }}</div>
                                    <div class="text-muted">Всего студентов</div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-info-circle me-3" style="font-size: 2rem;"></i>
                            <div>
                                <h5 class="mb-1">Группы не найдены</h5>
                                <p class="mb-0">В системе пока не создано ни одной учебной группы.</p>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Плавающая кнопка "Добавить группу" -->
    <a href="{{ url_for('add_group') }}" 
       class="btn btn-danger btn-add-floating"
       id="addButton"
       title="Добавить новую группу">
        <i class="bi bi-plus" style="line-height: 0;"></i>
    </a>

    <script>
        // Логика скрытия кнопки при скролле
        let lastScrollTop = 0;
        const addButton = document.getElementById('addButton');
        const scrollThreshold = 100;
        
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > scrollThreshold) {
                addButton.classList.add('hidden');
            } else {
                addButton.classList.remove('hidden');
            }
            
            lastScrollTop = scrollTop;
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            if (window.pageYOffset > scrollThreshold) {
                addButton.classList.add('hidden');
            }
        });
    </script>
</body>
</html>

================================================================================
ФАЙЛ: templates\admin_schedule.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\admin_schedule.html
РАЗМЕР: 12984 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Расписание</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* Существующие стили */
        .btn-add-floating {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
        }
        .btn-add-floating:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
            color: white;
        }
        .btn-add-floating.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }
        
        /* Стили для боковой панели */
        body { background-color: #f8f9fa; }
        .sidebar-menu { 
            position: sticky; 
            top: 20px; 
        }
        .list-group-item.active { 
            background-color: #dc3545 !important; 
            color: white !important; 
        }
        .quick-actions-card .card-header {
            background: linear-gradient(#ffc107);
        }
        .quick-actions-card .btn-add-schedule {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }
        .quick-actions-card .btn-add-schedule:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
        .card-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        .system-info-card .card-header {
            background: linear-gradient(135deg, #6c757d 0%, #6c757d 100%);
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <!-- Блок администрирования -->
                <div class="card mb-4 sidebar-menu">
                    <div class="card-header bg-danger text-white">
                        <i class="bi bi-menu-button"></i> Администрирование
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-speedometer2"></i> Панель управления
                        </a>
                        <a href="{{ url_for('admin_users') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-people"></i> Пользователи
                        </a>
                        <a href="{{ url_for('admin_groups') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-collection"></i> Группы
                        </a>
                        <a href="{{ url_for('admin_schedule') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-calendar-week"></i> Расписание
                        </a>
                        <a href="{{ url_for('admin_statistics') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-bar-chart"></i> Статистика
                        </a>
                    </div>
                </div>

                <!-- Быстрые действия -->
                <div class="card quick-actions-card">
                    <div class="card-header bg-warning text-dark">
                        <i class="bi bi-lightning"></i> Быстрые действия
                    </div>
                    <div class="card-body">
                        <!-- Добавление в расписание -->
                        <a href="{{ url_for('add_schedule') }}" class="btn btn-add-schedule btn-sm w-100 mb-2">
                            <i class="bi bi-calendar-plus"></i> Добавить в расписание
                        </a>
                        
                        <!-- Добавление пользователя -->
                        <a href="{{ url_for('add_user') }}" class="btn btn-warning btn-sm w-100 mb-2">
                            <i class="bi bi-person-plus"></i> Добавить пользователя
                        </a>
                        
                        <!-- Просмотр групп -->
                        <a href="{{ url_for('admin_groups') }}" class="btn btn-info btn-sm w-100 mb-2">
                            <i class="bi bi-eye"></i> Просмотр групп
                        </a>
                        
                        <!-- Просмотр статистики -->
                        <a href="{{ url_for('admin_statistics') }}" class="btn btn-success btn-sm w-100">
                            <i class="bi bi-graph-up"></i> Просмотр статистики
                        </a>
                    </div>
                </div>
                
                <!-- Информация о системе -->
                <div class="card mt-4 system-info-card">
                    <div class="card-header bg-secondary text-white">
                        <i class="bi bi-info-circle"></i> Информация о системе
                    </div>
                    <div class="card-body">
                        <small class="text-muted">
                            <div class="mb-1"><strong>Роль:</strong> Администратор</div>
                            <div class="mb-1"><strong>Вход:</strong> {{ session['login'] }}</div>
                            <div><strong>Время:</strong> {{ current_time if current_time else '' }}</div>
                        </small>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <h2><i class="bi bi-calendar-week"></i> Расписание</h2>
                
                <!-- Фильтр -->
                <div class="card mb-4">
                    <div class="card-body">
                        <form method="GET" class="row g-3">
                            <div class="col-md-3">
                                <label>Группа</label>
                                <select class="form-select" name="group_id">
                                    <option value="">Все группы</option>
                                    {% for group in groups %}
                                    <option value="{{ group[0] }}" {% if selected_group == group[0]|string %}selected{% endif %}>
                                        {{ group[1] }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label>Начальная дата</label>
                                <input type="date" name="start_date" class="form-control" value="{{ start_date }}">
                            </div>
                            <div class="col-md-3">
                                <label>Конечная дата</label>
                                <input type="date" name="end_date" class="form-control" value="{{ end_date }}">
                            </div>
                            <div class="col-md-3">
                                <label>&nbsp;</label>
                                <button type="submit" class="btn btn-primary w-100">Применить</button>
                            </div>
                        </form>
                    </div>
                </div>

                {% for day, lessons in schedule_by_day.items() %}
                <div class="card mb-3">
                    <div class="card-header bg-danger text-white">
                        <strong>{{ day.strftime('%A, %d.%m.%Y') }}</strong>
                    </div>
                    <div class="card-body">
                        {% if lessons %}
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Время</th>
                                            <th>Дисциплина</th>
                                            <th>Группа</th>
                                            <th>Тип</th>
                                            <th>Аудитория</th>
                                            <th>Преподаватель</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for lesson in lessons %}
                                        <tr>
                                            <td><strong>{{ lesson[3] }}</strong></td>
                                            <td>{{ lesson[1] }}</td>
                                            <td><span class="badge bg-primary">{{ lesson[6] }}</span></td>
                                            <td><span class="badge bg-secondary">{{ lesson[5] }}</span></td>
                                            <td>{{ lesson[4] }}</td>
                                            <td>{{ lesson[7] }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <p class="text-muted"><i class="bi bi-info-circle"></i> Занятий нет</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <a href="{{ url_for('add_schedule') }}" 
       class="btn btn-danger btn-add-floating"
       id="addScheduleButton"
       title="Добавить занятие в расписание">
        <i class="bi bi-calendar-plus" style="line-height: 0;"></i>
    </a>
    <script>
        // Логика скрытия кнопки при скролле
        let lastScrollTop = 0;
        const addScheduleButton = document.getElementById('addScheduleButton');
        const scrollThreshold = 100;
        
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > scrollThreshold) {
                addScheduleButton.classList.add('hidden');
            } else {
                addScheduleButton.classList.remove('hidden');
            }
            
            lastScrollTop = scrollTop;
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            if (window.pageYOffset > scrollThreshold) {
                addScheduleButton.classList.add('hidden');
            }
        });
    </script>
</body>
</html>

================================================================================
ФАЙЛ: templates\admin_statistics.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\admin_statistics.html
РАЗМЕР: 19803 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Статистика системы</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        /* Существующие стили */
        .stat-card { border-radius: 10px; transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-5px); }
        .progress-thin { height: 10px; }
        .attendance-badge {
            font-size: 0.9rem;
            padding: 5px 10px;
        }
        /* Стили для боковой панели */
        body { background-color: #f8f9fa; }
        .sidebar-menu { 
            position: sticky; 
            top: 20px; 
        }
        .list-group-item.active { 
            background-color: #dc3545 !important; 
            color: white !important; 
        }
        .quick-actions-card .card-header {
            background: linear-gradient(#ffc107);
        }
        .quick-actions-card .btn-view-statistics {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }
        .quick-actions-card .btn-view-statistics:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
        .card-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        .system-info-card .card-header {
            background: linear-gradient(135deg, #6c757d 0%, #6c757d 100%);
        }
        
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <!-- Блок администрирования -->
                <div class="card mb-4 sidebar-menu">
                    <div class="card-header bg-danger text-white">
                        <i class="bi bi-menu-button"></i> Администрирование
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-speedometer2"></i> Панель управления
                        </a>
                        <a href="{{ url_for('admin_users') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-people"></i> Пользователи
                        </a>
                        <a href="{{ url_for('admin_groups') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-collection"></i> Группы
                        </a>
                        <a href="{{ url_for('admin_schedule') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-calendar-week"></i> Расписание
                        </a>
                        <a href="{{ url_for('admin_statistics') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-bar-chart"></i> Статистика
                        </a>
                    </div>
                </div>

                <!-- Быстрые действия -->
                <div class="card quick-actions-card">
                    <div class="card-header bg-warning text-dark">
                        <i class="bi bi-lightning"></i> Быстрые действия
                    </div>
                    <div class="card-body">
                        <!-- Просмотр статистики -->
                        <a href="{{ url_for('admin_statistics') }}" class="btn btn-view-statistics btn-sm w-100 mb-2">
                            <i class="bi bi-graph-up"></i> Обновить статистику
                        </a>
                        
                        <!-- Добавление в расписание -->
                        <a href="{{ url_for('add_schedule') }}" class="btn btn-warning btn-sm w-100 mb-2">
                            <i class="bi bi-calendar-plus"></i> Добавить в расписание
                        </a>
                        
                        <!-- Просмотр пользователей -->
                        <a href="{{ url_for('admin_users') }}" class="btn btn-info btn-sm w-100 mb-2">
                            <i class="bi bi-eye"></i> Просмотр пользователей
                        </a>
                        
                        <!-- Просмотр групп -->
                        <a href="{{ url_for('admin_groups') }}" class="btn btn-success btn-sm w-100">
                            <i class="bi bi-collection"></i> Просмотр групп
                        </a>
                    </div>
                </div>
                
                <!-- Информация о системе -->
                <div class="card mt-4 system-info-card">
                    <div class="card-header bg-secondary text-white">
                        <i class="bi bi-info-circle"></i> Информация о системе
                    </div>
                    <div class="card-body">
                        <small class="text-muted">
                            <div class="mb-1"><strong>Роль:</strong> Администратор</div>
                            <div class="mb-1"><strong>Вход:</strong> {{ session['login'] }}</div>
                            <div><strong>Время:</strong> {{ current_time if current_time else '' }}</div>
                        </small>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <h2><i class="bi bi-bar-chart"></i> Статистика системы</h2>
                
                <!-- Общая статистика -->
                <div class="row mb-4">
                    <div class="col-md-2 mb-3">
                        <div class="card stat-card bg-primary text-white">
                            <div class="card-body text-center">
                                <h1 class="display-6">{{ stats[0] }}</h1>
                                <p class="mb-0"><i class="bi bi-people"></i> Студентов</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 mb-3">
                        <div class="card stat-card bg-success text-white">
                            <div class="card-body text-center">
                                <h1 class="display-6">{{ stats[1] }}</h1>
                                <p class="mb-0"><i class="bi bi-person"></i> Преподава-<br>телей</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 mb-3">
                        <div class="card stat-card bg-info text-white">
                            <div class="card-body text-center">
                                <h1 class="display-6">{{ stats[2] }}</h1>
                                <p class="mb-0"><i class="bi bi-collection"></i> Групп</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 mb-3">
                        <div class="card stat-card bg-warning text-dark">
                            <div class="card-body text-center">
                                <h1 class="display-6">{{ stats[3] }}</h1>
                                <p class="mb-0"><i class="bi bi-book"></i> Дисциплин</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 mb-3">
                        <div class="card stat-card bg-secondary text-white">
                            <div class="card-body text-center">
                                <h1 class="display-6">{{ stats[4] }}</h1>
                                <p class="mb-0"><i class="bi bi-calendar"></i> Занятий<br><small>(7 дней)</small></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 mb-3">
                        <div class="card stat-card bg-dark text-white">
                            <div class="card-body text-center">
                                <h1 class="display-6">{{ stats[5] }}</h1>
                                <p class="mb-0"><i class="bi bi-check-circle"></i> Отметок<br><small>(7 дней)</small></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Статистика посещаемости -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-clipboard-check"></i> Статистика посещаемости (30 дней)
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <h3 class="text-success">{{ attendance_stats[0] }}%</h3>
                                <p class="text-muted">Присутствовали</p>
                                <div class="progress progress-thin">
                                    <div class="progress-bar bg-success" style="width: {{ attendance_stats[0] }}%"></div>
                                </div>
                            </div>
                            <div class="col-md-3 text-center">
                                <h3 class="text-danger">{{ attendance_stats[1] }}%</h3>
                                <p class="text-muted">Отсутствовали</p>
                                <div class="progress progress-thin">
                                    <div class="progress-bar bg-danger" style="width: {{ attendance_stats[1] }}%"></div>
                                </div>
                            </div>
                            <div class="col-md-3 text-center">
                                <h3 class="text-warning">{{ attendance_stats[2] }}%</h3>
                                <p class="text-muted">По уважительной</p>
                                <div class="progress progress-thin">
                                    <div class="progress-bar bg-warning" style="width: {{ attendance_stats[2] }}%"></div>
                                </div>
                            </div>
                            <div class="col-md-3 text-center">
                                <h3 class="text-info">{{ attendance_stats[3] }}%</h3>
                                <p class="text-muted">Опоздали</p>
                                <div class="progress progress-thin">
                                    <div class="progress-bar bg-info" style="width: {{ attendance_stats[3] }}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-8">
                        <!-- Топ групп по посещаемости -->
                        <div class="card h-100">
                            <div class="card-header bg-info text-white">
                                <i class="bi bi-trophy"></i> Топ групп по посещаемости
                            </div>
                            <div class="card-body">
                                {% if top_groups %}
                                    {% for group in top_groups %}
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>{{ group[0] }}</span>
                                        <span class="badge bg-primary attendance-badge">{{ group[2] }}%</span>
                                    </div>
                                    <div class="progress mb-3 progress-thin">
                                        <div class="progress-bar" style="width: {{ group[2] }}%"></div>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted text-center py-3">Нет данных о посещаемости</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <!-- Сводка по статусам -->
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-list-check"></i> Сводка по статусам
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-success">
                                        <i class="bi bi-check-circle"></i> Присутствовали
                                    </span>
                                    <strong class="text-success">{{ attendance_stats[0] }}%</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-danger">
                                        <i class="bi bi-x-circle"></i> Отсутствовали
                                    </span>
                                    <strong class="text-danger">{{ attendance_stats[1] }}%</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-warning">
                                        <i class="bi bi-exclamation-circle"></i> Уважительная
                                    </span>
                                    <strong class="text-warning">{{ attendance_stats[2] }}%</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span class="text-info">
                                        <i class="bi bi-clock"></i> Опоздали
                                    </span>
                                    <strong class="text-info">{{ attendance_stats[3] }}%</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Последние отметки посещаемости -->
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <i class="bi bi-clock-history"></i> Последние отметки посещаемости
                    </div>
                    <div class="card-body">
                        {% if recent_attendance %}
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Студент</th>
                                            <th>Группа</th>
                                            <th>Дисциплина</th>
                                            <th>Статус</th>
                                            <th>Время</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for record in recent_attendance %}
                                        <tr>
                                            <td>{{ record[1] }}</td>
                                            <td><span class="badge bg-secondary">{{ record[5] }}</span></td>
                                            <td>{{ record[2] }}</td>
                                            <td>
                                                {% if record[3] == 'Присутствовал' %}
                                                    <span class="badge bg-success">Присутствовал</span>
                                                {% elif record[3] == 'Отсутствовал' %}
                                                    <span class="badge bg-danger">Отсутствовал</span>
                                                {% elif record[3] == 'По уважительной причине' %}
                                                    <span class="badge bg-warning">Уважительная</span>
                                                {% elif record[3] == 'Опоздал' %}
                                                    <span class="badge bg-info">Опоздал</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ record[3] }}</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ record[4].strftime('%H:%M %d.%m.%Y') }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <p class="text-muted text-center py-3">Нет данных о посещаемости</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

================================================================================
ФАЙЛ: templates\admin_users.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\admin_users.html
РАЗМЕР: 16335 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Управление пользователями</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        /* Существующие стили */
        .btn-add-floating {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
        }
        .btn-add-floating:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }
        .btn-add-floating.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }
        .user-card {
            transition: transform 0.2s;
            border-left: 4px solid #dc3545;
        }
        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        /* Стили для боковой панели */
        body { background-color: #f8f9fa; }
        .sidebar-menu { 
            position: sticky; 
            top: 20px; 
        }
        .list-group-item.active { 
            background-color: #dc3545 !important; 
            color: white !important; 
        }
        .quick-actions-card .card-header {
            background: linear-gradient(#ffc107);
        }
        .quick-actions-card .btn-add-user {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }
        .quick-actions-card .btn-add-user:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
        .card-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        .system-info-card .card-header {
            background: linear-gradient(135deg, #6c757d 0%, #6c757d 100%);
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <!-- Блок администрирования -->
                <div class="card mb-4 sidebar-menu">
                    <div class="card-header bg-danger text-white">
                        <i class="bi bi-menu-button"></i> Администрирование
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-speedometer2"></i> Панель управления
                        </a>
                        <a href="{{ url_for('admin_users') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-people"></i> Пользователи
                        </a>
                        <a href="{{ url_for('admin_groups') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-collection"></i> Группы
                        </a>
                        <a href="{{ url_for('admin_schedule') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-calendar-week"></i> Расписание
                        </a>
                        <a href="{{ url_for('admin_statistics') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-bar-chart"></i> Статистика
                        </a>
                    </div>
                </div>

                <!-- Быстрые действия -->
                <div class="card quick-actions-card">
                    <div class="card-header bg-warning text-dark">
                        <i class="bi bi-lightning"></i> Быстрые действия
                    </div>
                    <div class="card-body">
                        <!-- Добавление пользователя -->
                        <a href="{{ url_for('add_user') }}" class="btn btn-add-user btn-sm w-100 mb-2">
                            <i class="bi bi-person-plus"></i> Добавить пользователя
                        </a>
                        
                        <!-- Добавление в расписание -->
                        <a href="{{ url_for('add_schedule') }}" class="btn btn-warning btn-sm w-100 mb-2">
                            <i class="bi bi-calendar-plus"></i> Добавить в расписание
                        </a>
                        
                        <!-- Просмотр расписания -->
                        <a href="{{ url_for('admin_schedule') }}" class="btn btn-info btn-sm w-100 mb-2">
                            <i class="bi bi-eye"></i> Просмотр расписания
                        </a>
                        
                        <!-- Просмотр статистики -->
                        <a href="{{ url_for('admin_statistics') }}" class="btn btn-success btn-sm w-100">
                            <i class="bi bi-graph-up"></i> Просмотр статистики
                        </a>
                    </div>
                </div>
                
                <!-- Информация о системе -->
                <div class="card mt-4 system-info-card">
                    <div class="card-header bg-secondary text-white">
                        <i class="bi bi-info-circle"></i> Информация о системе
                    </div>
                    <div class="card-body">
                        <small class="text-muted">
                            <div class="mb-1"><strong>Роль:</strong> Администратор</div>
                            <div class="mb-1"><strong>Вход:</strong> {{ session['login'] }}</div>
                            <div><strong>Время:</strong> {{ current_time if current_time else '' }}</div>
                        </small>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <h2><i class="bi bi-people"></i> Управление пользователями</h2>
                <p class="text-muted">Пользователи системы</p>
                
                <!-- Фильтр по ролям и группам -->
                <div class="card mb-4">
                    <div class="card-body">
                        <form method="GET" class="row g-3">
                            <div class="col-md-4">
                                <select class="form-select" name="role" onchange="this.form.submit()">
                                    <option value="">Все роли</option>
                                    <option value="Студент" {% if role_filter == 'Студент' %}selected{% endif %}>Студенты</option>
                                    <option value="Преподаватель" {% if role_filter == 'Преподаватель' %}selected{% endif %}>Преподаватели</option>
                                    <option value="Администратор" {% if role_filter == 'Администратор' %}selected{% endif %}>Администраторы</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-select" name="group_id" onchange="this.form.submit()">
                                    <option value="">Все группы</option>
                                    {% for group in all_groups %}
                                    <option value="{{ group[0] }}" {% if group_filter == group[0]|string %}selected{% endif %}>
                                        {{ group[1] }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4">
                                <input type="text" class="form-control" name="search" placeholder="Поиск по ФИО..." 
                                       value="{{ search_query or '' }}">
                            </div>
                        </form>
                    </div>
                </div>

                {% if users %}
                    <div class="row">
                        {% for user in users %}
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card user-card h-100 position-relative">
                                <div class="card-header 
                                    {% if user[3] == 'Студент' %}bg-primary
                                    {% elif user[3] == 'Преподаватель' %}bg-success
                                    {% else %}bg-danger{% endif %} text-white">
                                    <h5 class="mb-0">{{ user[2] }}</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <small class="text-muted">Логин:</small>
                                        <div><code>{{ user[1] }}</code></div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <small class="text-muted">Роль:</small>
                                        <div>
                                            {% if user[3] == 'Студент' %}
                                                <span class="badge bg-primary">Студент</span>
                                            {% elif user[3] == 'Преподаватель' %}
                                                <span class="badge bg-success">Преподаватель</span>
                                            {% else %}
                                                <span class="badge bg-danger">Администратор</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    {% if user[3] == 'Студент' and user[6] %}
                                    <div class="mb-3">
                                        <small class="text-muted">Группа:</small>
                                        <div><span class="badge bg-secondary">{{ user[6] }}</span></div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if user[4] %}
                                    <div class="mb-3">
                                        <small class="text-muted">Email:</small>
                                        <div>{{ user[4] }}</div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if user[5] %}
                                    <div class="mb-3">
                                        <small class="text-muted">Телефон:</small>
                                        <div>{{ user[5] }}</div>
                                    </div>
                                    {% endif %}
                                    
                                    <!-- Кнопки действий -->
                                    <div class="d-flex justify-content-between mt-3">
                                        <a href="{{ url_for('edit_user', user_id=user[0]) }}" 
                                           class="btn btn-sm btn-outline-warning">
                                            <i class="bi bi-pencil"></i> Редактировать
                                        </a>
                                        
                                        {% if user[0] != session['user_id'] %}
                                        <form method="POST" action="{{ url_for('delete_user', user_id=user[0]) }}" 
                                              onsubmit="return confirm('Удалить пользователя {{ user[2] }}?')">
                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                <i class="bi bi-trash"></i> Удалить
                                            </button>
                                        </form>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-warning text-center">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        Пользователи не найдены
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Плавающая кнопка "Добавить пользователя" -->
    <a href="{{ url_for('add_user') }}" 
       class="btn btn-danger btn-add-floating"
       id="addButton"
       title="Добавить нового пользователя">
        <i class="bi bi-plus" style="line-height: 0;"></i>
    </a>

    <script>
        // Логика скрытия кнопки при скролле
        let lastScrollTop = 0;
        const addButton = document.getElementById('addButton');
        const scrollThreshold = 100;
        
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > scrollThreshold) {
                addButton.classList.add('hidden');
            } else {
                addButton.classList.remove('hidden');
            }
            
            lastScrollTop = scrollTop;
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            if (window.pageYOffset > scrollThreshold) {
                addButton.classList.add('hidden');
            }
        });
    </script>
</body>
</html>

================================================================================
ФАЙЛ: templates\edit_discipline.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\edit_discipline.html
РАЗМЕР: 5925 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Редактировать дисциплину</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
    .btn-back-teacher {
        background-color: #198754;  /* Зеленый цвет для преподавателя */
        color: white;
        border: 2px solid #198754;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s;
    }
    .btn-back-teacher:hover {
        background-color: #157347;
        border-color: #146c43;
        transform: scale(1.05);
        color: white;
    }
    /* Цвета формы */
    .form-control:focus {
        border-color: #20c997;
        box-shadow: 0 0 0 0.25rem rgba(32, 201, 151, 0.25);
    }
    .card-header {
        background: linear-gradient(135deg, #198754 0%, #146c43 100%);
    }
    .btn-warning {
        background-color: #ffc107;
        border-color: #ffc107;
    }
    .btn-warning:hover {
        background-color: #e0a800;
        border-color: #d39e00;
    }
</style>
</head>
<body>
    <nav class="navbar navbar-dark bg-success shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <a href="{{ url_for('dashboard') }}" class="btn btn-back-teacher">
                    <i class="bi bi-arrow-left-circle"></i> Назад в панель
                </a>
            </div>
        </div>
    </nav>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h4 class="mb-0"><i class="bi bi-pencil"></i> Редактировать дисциплину</h4>
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                                <div class="alert alert-warning">
                                    {% for message in messages %}
                                        <div>{{ message }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endwith %}

                        <form method="POST">
                            <div class="mb-3">
                                <label class="form-label">Название дисциплины *</label>
                                <input type="text" class="form-control" name="name" 
                                       value="{{ discipline[0] }}" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Описание</label>
                                <textarea class="form-control" name="description" rows="3">{{ discipline[1] or '' }}</textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Общее количество часов *</label>
                                <input type="number" class="form-control" name="total_hours" 
                                       value="{{ discipline[2] }}" min="1" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Текущие группы</label>
                                <div class="border p-3 bg-light">
                                    {% if discipline[3] and discipline[3] != 'Нет групп' %}
                                        {{ discipline[3] }}
                                    {% else %}
                                        <span class="text-muted">Группы не назначены</span>
                                    {% endif %}
                                </div>
                                <div class="mt-2">
                                    <a href="{{ url_for('manage_discipline_groups', discipline_id=discipline_id) }}" 
                                    class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-people"></i> Управление группами
                                    </a>
                                </div>
                                <small class="text-muted">Для изменения списка групп используйте кнопку "Управление группами"</small>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-warning">
                                    <i class="bi bi-save"></i> Сохранить изменения
                                </button>
                                <a href="{{ url_for('teacher_disciplines') }}" class="btn btn-secondary">Отмена</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

================================================================================
ФАЙЛ: templates\edit_group.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\edit_group.html
РАЗМЕР: 7290 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Редактировать группу {{ group[1] }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        .btn-back {
            background-color: #dc3545;
            color: white;
            border: 2px solid #dc3545;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .btn-back:hover {
            background-color: #c82333;
            border-color: #bd2130;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-danger">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <a href="{{ url_for('admin_groups') }}" class="btn btn-back">
                    <i class="bi bi-arrow-left-circle"></i> Назад к группам
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h4 class="mb-0"><i class="bi bi-pencil"></i> Редактировать группу: {{ group[1] }}</h4>
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                                <div class="alert alert-warning">
                                    {% for message in messages %}
                                        <div>{{ message }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endwith %}

                        <form method="POST" action="{{ url_for('update_group', group_id=group[0]) }}">
                            <div class="mb-3">
                                <label class="form-label">Код группы *</label>
                                <input type="text" class="form-control" name="group_code" 
                                       value="{{ group[1] }}" required>
                                <small class="text-muted">Уникальный код группы (например: ИВТ-101)</small>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Специализация</label>
                                <input type="text" class="form-control" name="specialization" 
                                       value="{{ group[2] or '' }}"
                                       placeholder="Например: Информатика и вычислительная техника">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Курс *</label>
                                <select class="form-select" name="year_of_study" required>
                                    {% for i in range(1, 7) %}
                                    <option value="{{ i }}" {% if group[3] == i %}selected{% endif %}>
                                        {{ i }} курс
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-warning">
                                    <i class="bi bi-save"></i> Сохранить изменения
                                </button>
                                
                                <a href="{{ url_for('admin_groups') }}" class="btn btn-secondary">
                                    <i class="bi bi-x-circle"></i> Отмена
                                </a>
                                
                                <!-- Кнопка удаления группы -->
                                <button type="button" class="btn btn-danger mt-3" 
                                        onclick="confirmDelete()">
                                    <i class="bi bi-trash"></i> Удалить группу
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Информация о студентах группы -->
                <div class="card mt-4">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-people"></i> Студенты в группе
                    </div>
                    <div class="card-body">
                        <p class="text-muted">
                            Для управления студентами этой группы перейдите в раздел 
                            <a href="{{ url_for('admin_users') }}?role=Студент&group_id={{ group[0] }}">
                                Управление пользователями
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function confirmDelete() {
            if (confirm('Вы уверены, что хотите удалить группу "{{ group[1] }}"?' + 
                       '\n\nВнимание: Все студенты этой группы также будут удалены!')) {
                // Создаем скрытую форму для удаления
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{{ url_for('delete_group', group_id=group[0]) }}";
                
                // Добавляем CSRF токен если есть
                const csrfToken = document.querySelector('input[name="csrf_token"]');
                if (csrfToken) {
                    form.appendChild(csrfToken.cloneNode(true));
                }
                
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>

================================================================================
ФАЙЛ: templates\edit_user.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\edit_user.html
РАЗМЕР: 6871 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Редактировать пользователя</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
<style>
    .btn-back {
        background-color: #dc3545;
        color: white;
        border: 2px solid #dc3545;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s;
    }
    .btn-back:hover {
        background-color: #c82333;
        border-color: #bd2130;
        transform: scale(1.05);
        color: white;
    }
</style>
</head>
<body>
    <nav class="navbar navbar-dark bg-danger">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <a href="{{ url_for('dashboard') }}" class="btn btn-back">
                    <i class="bi bi-arrow-left-circle"></i> Назад в панель
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h4 class="mb-0"><i class="bi bi-person-gear"></i> Редактировать пользователя</h4>
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                                <div class="alert alert-warning">
                                    {% for message in messages %}
                                        <div>{{ message }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endwith %}

                        <form method="POST">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Логин *</label>
                                    <input type="text" class="form-control" name="login" 
                                           value="{{ user[0] }}" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">ФИО *</label>
                                    <input type="text" class="form-control" name="full_name" 
                                           value="{{ user[1] }}" required>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Роль *</label>
                                    <select class="form-select" name="role" id="roleSelect" required>
                                        <option value="Студент" {% if user[2] == 'Студент' %}selected{% endif %}>Студент</option>
                                        <option value="Преподаватель" {% if user[2] == 'Преподаватель' %}selected{% endif %}>Преподаватель</option>
                                        <option value="Администратор" {% if user[2] == 'Администратор' %}selected{% endif %}>Администратор</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" name="email" 
                                           value="{{ user[3] or '' }}">
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Телефон</label>
                                    <input type="tel" class="form-control" name="phone" 
                                           value="{{ user[4] or '' }}">
                                </div>
                                <div class="col-md-6" id="groupField" 
                                     style="display: {% if user[2] == 'Студент' %}block{% else %}none{% endif %};">
                                    <label class="form-label">Группа</label>
                                    <select class="form-select" name="group_id">
                                        <option value="">Выберите группу</option>
                                        {% for group in groups %}
                                        <option value="{{ group[0] }}" 
                                                {% if user[5] == group[0] %}selected{% endif %}>
                                            {{ group[1] }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-warning">
                                    <i class="bi bi-save"></i> Сохранить изменения
                                </button>
                                <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">Отмена</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('roleSelect').addEventListener('change', function() {
            var groupField = document.getElementById('groupField');
            if (this.value === 'Студент') {
                groupField.style.display = 'block';
            } else {
                groupField.style.display = 'none';
            }
        });
    </script>
</body>
</html>

================================================================================
ФАЙЛ: templates\group_disciplines.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\group_disciplines.html
РАЗМЕР: 7066 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Дисциплины группы {{ group_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        .btn-back {
            background-color: #dc3545;
            color: white;
            border: 2px solid #dc3545;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .btn-back:hover {
            background-color: #c82333;
            border-color: #bd2130;
            transform: scale(1.05);
        }
        .discipline-card {
            transition: transform 0.2s;
            border-left: 4px solid #dc3545;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        }
        .discipline-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.15);
            border-left: 4px solid #ff6b6b;
        }
        .hours-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }
        .semester-badge {
            background: linear-gradient(135deg, #20c997 0%, #17a589 100%);
            color: white;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-danger shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <a href="{{ url_for('admin_groups') }}" class="btn btn-back">
                    <i class="bi bi-arrow-left-circle"></i> Назад к группам
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h2><i class="bi bi-book"></i> Дисциплины группы {{ group_name }}</h2>
                <p class="text-muted">Список всех дисциплин, которые изучает группа</p>
                
                {% if disciplines %}
                    <div class="row">
                        {% for disc in disciplines %}
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card discipline-card h-100 position-relative">
                                <div class="card-header bg-danger text-white">
                                    <h5 class="mb-0">{{ disc[1] }}</h5>
                                </div>
                                <div class="card-body">
                                    <!-- Бейдж с часами в правом верхнем углу -->
                                    <span class="badge hours-badge">{{ disc[3] }} ч.</span>
                                    
                                    <!-- Информация о дисциплине -->
                                    {% if disc[2] %}
                                    <div class="mb-3">
                                        <small class="text-muted d-block">Описание:</small>
                                        <div class="mt-1">
                                            {{ disc[2]|truncate(100) }}
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    <div class="mb-3">
                                        <small class="text-muted d-block">Преподаватель:</small>
                                        <div class="mt-1">
                                            <i class="bi bi-person"></i> {{ disc[4] }}
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <small class="text-muted d-block">Семестр:</small>
                                        <div class="mt-1">
                                            <span class="badge semester-badge">{{ disc[5] }} семестр</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Статистика -->
                    <div class="card mt-4">
                        <div class="card-header bg-secondary text-white">
                            <i class="bi bi-graph-up"></i> Статистика по дисциплинам
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-md-6 mb-3">
                                    <div class="display-6 text-primary">{{ disciplines|length }}</div>
                                    <div class="text-muted">Всего дисциплин</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    {% set total_hours = disciplines|sum(attribute='3') %}
                                    <div class="display-6 text-success">{{ total_hours }}</div>
                                    <div class="text-muted">Часов всего</div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="alert alert-warning">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-exclamation-triangle me-3" style="font-size: 2rem;"></i>
                            <div>
                                <h5 class="mb-1">Дисциплины не найдены</h5>
                                <p class="mb-0">Для этой группы пока не назначено ни одной дисциплины.</p>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

================================================================================
ФАЙЛ: templates\login.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\login.html
РАЗМЕР: 2859 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Вход в систему учёта посещаемости</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        body { background-color: #f5f5f5; }
        .login-container { max-width: 400px; margin-top: 100px; }
        .logo { text-align: center; margin-bottom: 30px; }
        .logo h1 { color: #0d6efd; }
        .btn-back-style {
            background-color: #0d6efd;
            color: white;
            border: 2px solid #0d6efd;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .btn-back-style:hover {
            background-color: #0b5ed7;
            border-color: #0a58ca;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="login-container mx-auto">
            <div class="logo">
                <h1>🎓 Учёт посещаемости</h1>
                <p class="text-muted">Система управления учебным процессом</p>
            </div>
            
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Вход в систему</h4>
                </div>
                <div class="card-body">
                    {% with messages = get_flashed_messages() %}
                        {% if messages %}
                            <div class="alert alert-warning">
                                {% for message in messages %}
                                    <div>{{ message }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endwith %}
                    
                    <form method="POST">
                        <div class="mb-3">
                            <label for="login" class="form-label">Логин</label>
                            <input type="text" class="form-control" id="login" name="login" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Пароль</label>
                            <input type="password" class="form-control" id="password" name="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Войти</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

================================================================================
ФАЙЛ: templates\manage_discipline_groups.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\manage_discipline_groups.html
РАЗМЕР: 14419 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Управление группами дисциплины</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
    .btn-back-teacher {
        background-color: #198754;
        color: white;
        border: 2px solid #198754;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s;
    }
    .btn-back-teacher:hover {
        background-color: #157347;
        border-color: #146c43;
        transform: scale(1.05);
        color: white;
    }
    .card-header {
        background: linear-gradient(135deg, #198754 0%, #146c43 100%);
    }
    .discipline-info {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }
    .group-item {
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 10px;
        transition: all 0.3s;
    }
    .group-item:hover {
        background-color: #f1f3f4;
        border-color: #198754;
    }
    .group-item.selected {
        background-color: #d4edda;
        border-color: #198754;
    }
    .semester-input {
        width: 100px;
        transition: all 0.3s;
    }
    .semester-input:focus {
        border-color: #20c997;
        box-shadow: 0 0 0 0.25rem rgba(32, 201, 151, 0.25);
    }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-success shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <a href="{{ url_for('teacher_disciplines') }}" class="btn btn-back-teacher">
                    <i class="bi bi-arrow-left-circle"></i> Назад к дисциплинам
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header text-white">
                        <h4 class="mb-0"><i class="bi bi-people"></i> Управление группами для дисциплины</h4>
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                                {% for category, message in messages %}
                                <div class="alert alert-{{ category if category != 'message' else 'info' }}">
                                    {{ message }}
                                </div>
                                {% endfor %}
                            {% endif %}
                        {% endwith %}

                        <!-- Информация о дисциплине -->
                        <div class="discipline-info mb-4">
                            <h5>{{ discipline_name }}</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <small class="text-muted">Описание:</small>
                                    <div>{{ discipline_data[1] or 'Нет описания' }}</div>
                                </div>
                                <div class="col-md-6">
                                    <small class="text-muted">Часов всего:</small>
                                    <div class="fw-bold">{{ discipline_data[2] }}</div>
                                </div>
                            </div>
                        </div>

                        <form method="POST">
                            <input type="hidden" name="discipline_id" value="{{ discipline_id }}">
                            
                            <div class="mb-4">
                                <label class="form-label fw-bold">Выберите группы для изучения дисциплины:</label>
                                <p class="text-muted">Отметьте группы, которые должны изучать эту дисциплину</p>
                                
                                <div class="border p-3 rounded" id="groupsContainer">
                                    {% if all_groups %}
                                        {% for group in all_groups %}
                                        {% set is_selected = group[0]|string in current_groups_dict %}
                                        <div class="group-item {% if is_selected %}selected{% endif %}">
                                            <div class="form-check">
                                                <input class="form-check-input group-checkbox" 
                                                       type="checkbox" 
                                                       name="groups" 
                                                       value="{{ group[0] }}" 
                                                       id="group{{ group[0] }}"
                                                       {% if is_selected %}checked{% endif %}>
                                                <label class="form-check-label fw-bold" for="group{{ group[0] }}">
                                                    {{ group[1] }}
                                                </label>
                                            </div>
                                            
                                            <!-- Поле для семестра (отображается только если группа выбрана) -->
                                            <div class="mt-2 semester-field" 
                                                 style="display: {% if is_selected %}block{% else %}none{% endif %};">
                                                <small class="text-muted">Семестр:</small>
                                                <input type="number" 
                                                       class="form-control form-control-sm semester-input" 
                                                       name="semester_{{ group[0] }}" 
                                                       placeholder="Семестр (1-12)" 
                                                       min="1" max="12" 
                                                       value="{{ current_groups_dict.get(group[0]|string, '') }}"
                                                       data-group="{{ group[0] }}">
                                                <small class="text-muted">Укажите семестр изучения</small>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="alert alert-warning">
                                            <i class="bi bi-exclamation-triangle"></i> Нет доступных групп
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="mt-3 text-muted">
                                    <small><i class="bi bi-info-circle"></i> Для каждой выбранной группы укажите семестр (от 1 до 12)</small>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-save"></i> Сохранить изменения
                                </button>
                                <a href="{{ url_for('teacher_disciplines') }}" class="btn btn-secondary">Отмена</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const checkboxes = document.querySelectorAll('.group-checkbox');
            const form = document.querySelector('form');
            
            // Обработка выбора группы
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const groupId = this.value;
                    const groupItem = this.closest('.group-item');
                    const semesterField = groupItem.querySelector('.semester-field');
                    const semesterInput = groupItem.querySelector('.semester-input');
                    
                    if (this.checked) {
                        groupItem.classList.add('selected');
                        semesterField.style.display = 'block';
                        semesterInput.required = true;
                    } else {
                        groupItem.classList.remove('selected');
                        semesterField.style.display = 'none';
                        semesterInput.required = false;
                        semesterInput.value = '';
                    }
                });
            });
            
            // Валидация формы
            form.addEventListener('submit', function(event) {
                let selectedGroups = [];
                let allSemestersValid = true;
                let errorMessages = [];
                
                // Собираем выбранные группы
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selectedGroups.push(checkbox.value);
                    }
                });
                
                // Проверка: выбрана ли хотя бы одна группа
                if (selectedGroups.length === 0) {
                    errorMessages.push('Необходимо выбрать хотя бы одну группу');
                }
                
                // Проверка семестров для выбранных групп
                selectedGroups.forEach(groupId => {
                    const semesterInput = document.querySelector(`.semester-input[data-group="${groupId}"]`);
                    const semesterValue = semesterInput.value.trim();
                    const groupName = document.querySelector(`label[for="group${groupId}"]`).textContent.trim();
                    
                    if (!semesterValue) {
                        errorMessages.push(`Для группы "${groupName}" не указан семестр`);
                        semesterInput.classList.add('is-invalid');
                        allSemestersValid = false;
                    } else if (parseInt(semesterValue) < 1 || parseInt(semesterValue) > 12) {
                        errorMessages.push(`Для группы "${groupName}" указан некорректный семестр (должен быть от 1 до 12)`);
                        semesterInput.classList.add('is-invalid');
                        allSemestersValid = false;
                    } else {
                        semesterInput.classList.remove('is-invalid');
                    }
                });
                
                // Если есть ошибки, предотвращаем отправку
                if (errorMessages.length > 0) {
                    event.preventDefault();
                    
                    // Показываем ошибки
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-danger mt-3';
                    alertDiv.innerHTML = `
                        <h5><i class="bi bi-exclamation-triangle"></i> Обнаружены ошибки:</h5>
                        <ul class="mb-0">
                            ${errorMessages.map(msg => `<li>${msg}</li>`).join('')}
                        </ul>
                    `;
                    
                    // Удаляем предыдущие сообщения об ошибках
                    const existingAlert = document.querySelector('.alert-danger');
                    if (existingAlert) {
                        existingAlert.remove();
                    }
                    
                    // Вставляем новое сообщение
                    form.parentNode.insertBefore(alertDiv, form);
                    
                    // Прокручиваем к ошибкам
                    alertDiv.scrollIntoView({ behavior: 'smooth' });
                    
                    return false;
                }
                
                return true;
            });
            
            // Валидация семестров при вводе
            const semesterInputs = document.querySelectorAll('.semester-input');
            semesterInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    if (value < 1 || value > 12) {
                        this.classList.add('is-invalid');
                    } else {
                        this.classList.remove('is-invalid');
                    }
                });
            });
        });
    </script>
</body>
</html>

================================================================================
ФАЙЛ: templates\mark_attendance.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\mark_attendance.html
РАЗМЕР: 20372 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Отметка посещаемости</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        /* Существующие стили остаются без изменений */
        .attendance-form { 
            background-color: #f8f9fa; 
            border-radius: 8px; 
            padding: 20px;
            border: 1px solid #e0e0e0;
        }
        .student-row { 
            transition: background-color 0.3s;
            border-left: 3px solid #d4edda;
        }
        .student-row:hover { 
            background-color: #f1f3f4;
            border-left: 3px solid #20c997;
        }
        .status-select {
            min-width: 180px;
        }
        .btn-present {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        .btn-present:hover, .btn-present.active {
            background-color: #155724;
            color: white;
            border-color: #155724;
        }
        .btn-absent {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }
        .btn-absent:hover, .btn-absent.active {
            background-color: #721c24;
            color: white;
            border-color: #721c24;
        }
        .btn-excused {
            background-color: #fff3cd;
            color: #856404;
            border-color: #ffeaa7;
        }
        .btn-excused:hover, .btn-excused.active {
            background-color: #856404;
            color: white;
            border-color: #856404;
        }
        .btn-late {
            background-color: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }
        .btn-late:hover, .btn-late.active {
            background-color: #0c5460;
            color: white;
            border-color: #0c5460;
        }
        .badge-status { 
            cursor: pointer; 
            transition: all 0.2s;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        .badge-status:hover { 
            opacity: 0.8;
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        /* Стили для боковой панели */
        body { background-color: #f8f9fa; }
        .sidebar-teacher {
            border-left: 4px solid #20c997;
        }
        .list-group-item.active {
            background-color: #198754 !important;
            border-color: #20533c !important;
        }
        .quick-actions-card .card-header {
            background: linear-gradient(135deg, #3c9958 0%, #0d663d 100%);
        }
        .quick-actions-card .btn-add-discipline {
            background-color: #20c997;
            border-color: #20c997;
            color: white;
        }
        .quick-actions-card .btn-add-discipline:hover {
            background-color: #17a589;
            border-color: #148f77;
        }
        .quick-actions-card .btn-mark-attendance {
            background-color: #198754;
            border-color: #198754;
            color: white;
        }
        .quick-actions-card .btn-mark-attendance:hover {
            background-color: #157347;
            border-color: #146c43;
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-menu-button"></i> Меню преподавателя
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-speedometer2"></i> Панель
                        </a>
                        <a href="{{ url_for('teacher_disciplines') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-book"></i> Мои дисциплины
                        </a>
                        <a href="{{ url_for('mark_attendance') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-clipboard-check"></i> Отметка посещаемости
                        </a>
                        <a href="{{ url_for('teacher_statistics') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-bar-chart"></i> Статистика
                        </a>
                    </div>
                </div>

                <!-- Быстрые действия -->
                <div class="card quick-actions-card">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-lightning"></i> Быстрые действия
                    </div>
                    <div class="card-body">
                        <a href="{{ url_for('add_discipline') }}" class="btn btn-add-discipline btn-sm w-100 mb-2">
                            <i class="bi bi-plus-circle"></i> Добавить дисциплину
                        </a>
                        <a href="{{ url_for('mark_attendance') }}" class="btn btn-mark-attendance btn-sm w-100">
                            <i class="bi bi-check-circle"></i> Отметить посещаемость
                        </a>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <h2><i class="bi bi-clipboard-check"></i> Отметка посещаемости</h2>
                <p class="text-muted">Дата: {{ today.strftime('%d.%m.%Y') }}</p>

                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        <div class="alert alert-success">
                            {% for message in messages %}
                                <div>{{ message }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                {% if not today_classes %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> На сегодня у вас нет занятий
                    </div>
                {% else %}
                    <div class="alert alert-primary">
                        <i class="bi bi-info-circle"></i> Выберите занятие для отметки посещаемости
                    </div>
                {% endif %}

                <!-- Выбор занятия -->
                <div class="row mb-4">
                    {% for class in today_classes %}
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-0">{{ class[1] }}</h5>
                                    <small>{{ class[2] }} | {{ class[3] }} | {{ class[4] }}</small>
                                </div>
                                <button class="btn btn-light btn-sm" onclick="loadClassStudents({{ class[0] }})">
                                    <i class="bi bi-people"></i> Отметить посещаемость
                                </button>
                            </div>
                            <div class="card-body">
                                <p class="mb-1"><strong>Группа:</strong> {{ class[3] }}</p>
                                <p class="mb-1"><strong>Аудитория:</strong> {{ class[4] }}</p>
                                <p class="mb-0"><strong>Тип:</strong> {{ class[5] }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Форма для отметки посещаемости (скрыта по умолчанию) -->
                <div id="attendanceContainer" style="display: none;">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h4 class="mb-0" id="className"></h4>
                            <small id="classDetails"></small>
                        </div>
                        <div class="card-body">
                            <form id="attendanceForm" method="POST">
                                <input type="hidden" name="schedule_id" id="scheduleId">
                                
                                <div id="studentsList" class="mb-4">
                                    <!-- Студенты будут загружены здесь динамически -->
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button type="submit" class="btn btn-success">
                                        <i class="bi bi-save"></i> Сохранить все отметки
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                                        <i class="bi bi-x-circle"></i> Отмена
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Существующий JavaScript остается без изменений -->
    <script>
        // Текущие данные о занятии и студентах
        let currentClassData = null;
        let attendanceData = {};

        // Загрузка студентов для выбранного занятия
        async function loadClassStudents(scheduleId) {
            try {
                const response = await fetch(`/teacher/attendance/class/${scheduleId}`);
                const data = await response.json();
                
                if (data.error) {
                    alert(data.error);
                    return;
                }
                
                currentClassData = data;
                attendanceData = {};
                
                // Отображаем информацию о занятии
                document.getElementById('className').textContent = data.class_info.name;
                document.getElementById('classDetails').innerHTML = 
                    `${data.class_info.date} | ${data.class_info.time} | ${data.class_info.group} | ${data.class_info.classroom}`;
                document.getElementById('scheduleId').value = data.class_info.id;
                
                // Очищаем и заполняем список студентов
                const studentsList = document.getElementById('studentsList');
                studentsList.innerHTML = '';
                
                if (data.students.length === 0) {
                    studentsList.innerHTML = '<div class="alert alert-warning">В группе нет студентов</div>';
                } else {
                    data.students.forEach((student, index) => {
                        const studentHtml = `
                            <div class="card mb-3 student-row">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-md-4">
                                            <h6 class="mb-0">${student.name}</h6>
                                            <small class="text-muted">${student.login}</small>
                                        </div>
                                        <div class="col-md-5">
                                            <div class="btn-group btn-group-sm" role="group">
                                                ${getStatusButtons(student.id, student.status)}
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <input type="text" 
                                                   class="form-control form-control-sm notes-input" 
                                                   id="notes_${student.id}"
                                                   placeholder="Примечание"
                                                   value="${student.notes || ''}"
                                                   onchange="updateAttendanceData(${student.id}, 'notes', this.value)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        studentsList.innerHTML += studentHtml;
                        
                        // Сохраняем начальные данные
                        attendanceData[student.id] = {
                            status: student.status,
                            notes: student.notes || ''
                        };
                    });
                }
                
                // Показываем форму
                document.getElementById('attendanceContainer').style.display = 'block';
                window.scrollTo({ top: document.getElementById('attendanceContainer').offsetTop - 20, behavior: 'smooth' });
                
            } catch (error) {
                console.error('Ошибка загрузки студентов:', error);
                alert('Ошибка загрузки данных о студентах');
            }
        }

        // Генерация кнопок статуса
        function getStatusButtons(studentId, currentStatus) {
            const statuses = [
                {value: 'Присутствовал', label: 'Присутствовал', class: 'btn-success'},
                {value: 'Отсутствовал', label: 'Отсутствовал', class: 'btn-danger'},
                {value: 'По уважительной причине', label: 'Уважительная', class: 'btn-warning'},
                {value: 'Опоздал', label: 'Опоздал', class: 'btn-info'}
            ];
            
            return statuses.map(status => `
                <input type="radio" 
                       class="btn-check" 
                       name="status_${studentId}" 
                       id="status_${studentId}_${status.value}" 
                       value="${status.value}"
                       ${currentStatus === status.value ? 'checked' : ''}
                       onchange="updateAttendanceData(${studentId}, 'status', '${status.value}')">
                <label class="btn btn-outline-${status.class.split('-')[1]}" 
                       for="status_${studentId}_${status.value}">
                    ${status.label}
                </label>
            `).join('');
        }

        // Обновление данных посещаемости
        function updateAttendanceData(studentId, field, value) {
            if (!attendanceData[studentId]) {
                attendanceData[studentId] = {};
            }
            attendanceData[studentId][field] = value;
        }

        // Сброс формы
        function resetForm() {
            document.getElementById('attendanceContainer').style.display = 'none';
            currentClassData = null;
            attendanceData = {};
        }

        // Обработка отправки формы
        document.getElementById('attendanceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const scheduleId = document.getElementById('scheduleId').value;
            const teacherId = {{ session['user_id'] }};
            
            if (!currentClassData || Object.keys(attendanceData).length === 0) {
                alert('Нет данных для сохранения');
                return;
            }
            
            // Отправляем данные для каждого студента
            let savedCount = 0;
            let errorCount = 0;
            
            for (const studentId in attendanceData) {
                const data = attendanceData[studentId];
                
                const formData = new FormData();
                formData.append('schedule_id', scheduleId);
                formData.append('student_id', studentId);
                formData.append('status', data.status);
                formData.append('notes', data.notes || '');
                formData.append('marked_by', teacherId);
                
                try {
                    const response = await fetch('{{ url_for("mark_attendance") }}', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        savedCount++;
                    } else {
                        errorCount++;
                    }
                } catch (error) {
                    console.error('Ошибка сохранения:', error);
                    errorCount++;
                }
            }
            
            // Показываем результат
            if (errorCount === 0) {
                alert(`Посещаемость успешно сохранена для ${savedCount} студентов`);
                resetForm();
                location.reload(); // Обновляем страницу
            } else {
                alert(`Сохранено: ${savedCount}, Ошибок: ${errorCount}`);
            }
        });

        // Инициализация страницы - автозагрузка первого занятия (опционально)
        document.addEventListener('DOMContentLoaded', function() {
            const firstClass = document.querySelector('.card .btn-light');
            if (firstClass) {
                // Можно автозагрузить первое занятие
                // firstClass.click();
            }
        });
    </script>
</body>
</html>

================================================================================
ФАЙЛ: templates\student_attendance.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\student_attendance.html
РАЗМЕР: 8864 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Посещаемость студента</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        /* Существующие стили */
        .status-present { background-color: #d4edda; }
        .status-absent { background-color: #f8d7da; }
        .status-excused { background-color: #fff3cd; }
        
        /* Стили для боковой панели */
        body { background-color: #f8f9fa; }
        .sidebar { 
            background-color: #ffffff; 
            border-radius: 10px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .nav-link.active { 
            background-color: #0d6efd; 
            color: white !important; 
        }
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid #e0e0e0;
        }
        .card-header {
            background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                    {% if session.get('group_name') %}
                    <small>({{ session.get('group_name') }})</small>
                    {% endif %}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <div class="sidebar p-3 mb-4">
                    <h5 class="mb-3"><i class="bi bi-menu-button"></i> Меню студента</h5>
                    <div class="list-group">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-speedometer2"></i> Панель
                        </a>
                        <a href="{{ url_for('student_schedule') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-calendar-week"></i> Расписание
                        </a>
                        <a href="{{ url_for('student_attendance') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-clipboard-check"></i> Посещаемость
                        </a>
                        <a href="{{ url_for('student_disciplines') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-book"></i> Дисциплины
                        </a>
                    </div>
                </div>

                <!-- Фильтр периода -->
                <div class="card stat-card mb-4">
                    <div class="card-header bg-info text-white">
                        <i class="bi bi-calendar-range"></i> Период просмотра
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <small class="text-muted">Начало периода:</small>
                            <div class="fw-bold">{{ start_date.strftime('%d.%m.%Y') }}</div>
                        </div>
                        <div>
                            <small class="text-muted">Конец периода:</small>
                            <div class="fw-bold">{{ end_date.strftime('%d.%m.%Y') }}</div>
                        </div>
                        <hr>
                        <small class="text-muted">Показано записей:</small>
                        <div class="fw-bold text-center">{{ attendance|length if attendance else 0 }}</div>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <h2><i class="bi bi-clipboard-check"></i> Моя посещаемость</h2>
                
                <!-- Фильтр -->
                <div class="card mb-4">
                    <div class="card-body">
                        <form method="GET" class="row g-3">
                            <div class="col-md-4">
                                <label>Начальная дата</label>
                                <input type="date" name="start_date" class="form-control" value="{{ start_date }}">
                            </div>
                            <div class="col-md-4">
                                <label>Конечная дата</label>
                                <input type="date" name="end_date" class="form-control" value="{{ end_date }}">
                            </div>
                            <div class="col-md-4">
                                <label>&nbsp;</label>
                                <button type="submit" class="btn btn-primary w-100">Применить</button>
                            </div>
                        </form>
                    </div>
                </div>

                {% if attendance %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Дата</th>
                                    <th>Время</th>
                                    <th>Дисциплина</th>
                                    <th>Статус</th>
                                    <th>Преподаватель</th>
                                    <th>Примечания</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in attendance %}
                                <tr class="status-{{ 'present' if record[4] == 'Присутствовал' else 'absent' if record[4] == 'Отсутствовал' else 'excused' }}">
                                    <td>{{ record[2].strftime('%d.%m.%Y') }}</td>
                                    <td>{{ record[3] }}</td>
                                    <td><strong>{{ record[1] }}</strong></td>
                                    <td>
                                        {% if record[4] == 'Присутствовал' %}
                                            <span class="badge bg-success">Присутствовал</span>
                                        {% elif record[4] == 'Отсутствовал' %}
                                            <span class="badge bg-danger">Отсутствовал</span>
                                        {% elif record[4] == 'По уважительной причине' %}
                                            <span class="badge bg-warning text-dark">По уважительной причине</span>
                                        {% else %}
                                            <span class="badge bg-info">{{ record[4] }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ record[6] }}</td>
                                    <td>{{ record[5] or '-' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> За выбранный период данных о посещаемости нет
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>

================================================================================
ФАЙЛ: templates\student_dashboard.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\student_dashboard.html
РАЗМЕР: 10178 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Панель студента</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
    body { background-color: #f8f9fa; }
    .sidebar { background-color: #ffffff; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .nav-link.active { background-color: #0d6efd; color: white !important; }
    .lesson-card { 
        border-left: 4px solid #0d6efd;
        border-radius: 8px;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    }
    .lesson-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(13, 110, 253, 0.15);
    }
    .card-header {
        background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
        border-bottom: none;
    }
    .badge.bg-secondary {
        background-color: #6c757d !important;
    }
    .stat-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border: 1px solid #e0e0e0;
    }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ full_name }}
                    {% if session.get('group_name') %}
                    <small>({{ session.get('group_name') }})</small>
                    {% endif %}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <div class="sidebar p-3 mb-4">
                    <h5 class="mb-3"><i class="bi bi-menu-button"></i> Меню студента</h5>
                    <div class="list-group">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-speedometer2"></i> Панель
                        </a>
                        <a href="{{ url_for('student_schedule') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-calendar-week"></i> Расписание
                        </a>
                        <a href="{{ url_for('student_attendance') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-clipboard-check"></i> Посещаемость
                        </a>
                        <a href="{{ url_for('student_disciplines') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-book"></i> Дисциплины
                        </a>
                    </div>
                </div>

                <!-- Статистика -->
                <div class="card stat-card mb-4">
                    <div class="card-header bg-info text-white">
                        <i class="bi bi-bar-chart"></i> Статистика (30 дней)
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Всего занятий:</span>
                            <strong>{{ stats[0] if stats else 0 }}</strong>
                        </div>
                        
                        <!-- Прогресс-бар посещаемости -->
                        {% if stats and stats[0] > 0 %}
                        {% set attendance_rate = ((stats[1] / stats[0]) * 100)|round(1) %}
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <small>Уровень посещаемости</small>
                                <small class="text-success"><strong>{{ attendance_rate }}%</strong></small>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-success" style="width: {{ attendance_rate }}%"></div>
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-success">
                                <i class="bi bi-check-circle"></i> Присутствовал:
                            </span>
                            <strong class="text-success">{{ stats[1] if stats else 0 }}</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-danger">
                                <i class="bi bi-x-circle"></i> Отсутствовал:
                            </span>
                            <strong class="text-danger">{{ stats[2] if stats else 0 }}</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-warning">
                                <i class="bi bi-exclamation-circle"></i> По уважительной:
                            </span>
                            <strong class="text-warning">{{ stats[3] if stats else 0 }}</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-info">
                                <i class="bi bi-clock"></i> Опоздал:
                            </span>
                            <strong class="text-info">{{ stats[4] if stats and stats|length > 4 else 0 }}</strong>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3><i class="bi bi-calendar-day"></i> Расписание на сегодня</h3>
                    <span class="badge bg-primary">{{ today_date.strftime('%d.%m.%Y') }}</span>
                </div>

                {% if today_schedule %}
                    <div class="row">
                        {% for lesson in today_schedule %}
                        <div class="col-md-6 mb-3">
                            <div class="card lesson-card h-100">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <strong>{{ lesson[1] }}</strong>
                                    <span class="badge bg-secondary">{{ lesson[4] }}</span>
                                </div>
                                <div class="card-body">
                                    <p class="mb-2"><i class="bi bi-clock"></i> <strong>{{ lesson[2] }}</strong></p>
                                    <p class="mb-2"><i class="bi bi-geo-alt"></i> Аудитория: {{ lesson[3] }}</p>
                                    <p class="mb-0"><i class="bi bi-person"></i> Преподаватель: {{ lesson[5] }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> На сегодня занятий нет
                    </div>
                {% endif %}

                <h3 class="mt-5 mb-3"><i class="bi bi-book"></i> Ваши дисциплины</h3>
                {% if disciplines %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Дисциплина</th>
                                    <th>Часов всего</th>
                                    <th>Семестр</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for disc in disciplines %}
                                <tr>
                                    <td>{{ disc[0] }}</td>
                                    <td><span class="badge bg-primary">{{ disc[1] }}</span></td>
                                    <td>{{ disc[2] }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i> Дисциплины не назначены
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

================================================================================
ФАЙЛ: templates\student_disciplines.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\student_disciplines.html
РАЗМЕР: 8173 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Дисциплины студента</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        /* Стили для боковой панели */
        body { background-color: #f8f9fa; }
        .sidebar { 
            background-color: #ffffff; 
            border-radius: 10px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .nav-link.active { 
            background-color: #0d6efd; 
            color: white !important; 
        }
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid #e0e0e0;
        }
        .card-header {
            background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
            border-bottom: none;
        }
        .progress {
            height: 20px;
        }
        .progress-bar {
            background: linear-gradient(90deg, #0d6efd 0%, #20c997 100%);
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                    {% if session.get('group_name') %}
                    <small>({{ session.get('group_name') }})</small>
                    {% endif %}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <div class="sidebar p-3 mb-4">
                    <h5 class="mb-3"><i class="bi bi-menu-button"></i> Меню студента</h5>
                    <div class="list-group">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-speedometer2"></i> Панель
                        </a>
                        <a href="{{ url_for('student_schedule') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-calendar-week"></i> Расписание
                        </a>
                        <a href="{{ url_for('student_attendance') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-clipboard-check"></i> Посещаемость
                        </a>
                        <a href="{{ url_for('student_disciplines') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-book"></i> Дисциплины
                        </a>
                    </div>
                </div>

                <!-- Сводная информация -->
                <div class="card stat-card mb-4">
                    <div class="card-header bg-info text-white">
                        <i class="bi bi-info-circle"></i> Сводная информация
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <small class="text-muted">Всего дисциплин:</small>
                            <div class="fw-bold text-center display-6">{{ disciplines|length if disciplines else 0 }}</div>
                        </div>
                        <div>
                            <small class="text-muted">Активных семестров:</small>
                            <div class="fw-bold">
                                {% if disciplines %}
                                    {% set semesters = [] %}
                                    {% for disc in disciplines %}
                                        {% if disc[4] not in semesters %}
                                            {% set _ = semesters.append(disc[4]) %}
                                        {% endif %}
                                    {% endfor %}
                                    {{ semesters|length }}
                                {% else %}
                                    0
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <h2><i class="bi bi-book"></i> Мои дисциплины</h2>
                <p class="text-muted">Список всех дисциплин, которые вы изучаете</p>

                {% if disciplines %}
                    <div class="row">
                        {% for disc in disciplines %}
                        <div class="col-md-6 mb-3">
                            <div class="card h-100">
                                <div class="card-header bg-primary text-white">
                                    <strong>{{ disc[1] }}</strong>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">{{ disc[2] or 'Описание отсутствует' }}</p>
                                    <hr>
                                    <div class="row">
                                        <div class="col">
                                            <small class="text-muted">Часов всего:</small>
                                            <div class="fw-bold">{{ disc[3] }}</div>
                                        </div>
                                        <div class="col">
                                            <small class="text-muted">Семестр:</small>
                                            <div class="fw-bold">{{ disc[4] }}</div>
                                        </div>
                                        <div class="col">
                                            <small class="text-muted">Преподаватель:</small>
                                            <div class="fw-bold">{{ disc[5] }}</div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <small class="text-muted">Посещено занятий:</small>
                                        <div class="progress">
                                            <div class="progress-bar" style="width: {{ (disc[6]/disc[3]*100) if disc[3] > 0 else 0 }}%">
                                                {{ disc[6] }}/{{ disc[3] }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i> У вас нет назначенных дисциплин
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>

================================================================================
ФАЙЛ: templates\student_schedule.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\student_schedule.html
РАЗМЕР: 10979 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Расписание студента</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        /* Существующие стили */
        .today-header { 
            background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%) !important;
            color: white;
        }
        .past-header { 
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%) !important;
            color: white;
        }
        .future-header { 
            background: linear-gradient(135deg, #20c997 0%, #17a589 100%) !important;
            color: white;
        }
        .lesson-time {
            font-weight: bold;
            color: #0d6efd;
        }
        .lesson-discipline {
            color: #212529;
            font-weight: 500;
        }
        .lesson-type {
            background-color: #e3f2fd;
            color: #0d6efd;
            font-size: 0.85em;
        }
        .lesson-classroom {
            color: #6c757d;
            font-size: 0.9em;
        }
        .lesson-teacher {
            color: #495057;
            font-size: 0.9em;
        }
        .card {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .table tbody tr {
            transition: background-color 0.2s;
        }
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        /* Стили для боковой панели */
        body { background-color: #f8f9fa; }
        .sidebar { 
            background-color: #ffffff; 
            border-radius: 10px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .nav-link.active { 
            background-color: #0d6efd; 
            color: white !important; 
        }
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid #e0e0e0;
        }
        .card-header {
            background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                    {% if session.get('group_name') %}
                    <small>({{ session.get('group_name') }})</small>
                    {% endif %}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <div class="sidebar p-3 mb-4">
                    <h5 class="mb-3"><i class="bi bi-menu-button"></i> Меню студента</h5>
                    <div class="list-group">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-speedometer2"></i> Панель
                        </a>
                        <a href="{{ url_for('student_schedule') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-calendar-week"></i> Расписание
                        </a>
                        <a href="{{ url_for('student_attendance') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-clipboard-check"></i> Посещаемость
                        </a>
                        <a href="{{ url_for('student_disciplines') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-book"></i> Дисциплины
                        </a>
                    </div>
                </div>

                <!-- Быстрая информация -->
                <div class="card stat-card mb-4">
                    <div class="card-header bg-info text-white">
                        <i class="bi bi-info-circle"></i> Быстрая информация
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <small class="text-muted">Группа:</small>
                            <div class="fw-bold">{{ group_name }}</div>
                        </div>
                        <div class="mb-3">
                            <small class="text-muted">Текущая дата:</small>
                            <div class="fw-bold">{{ today_date.strftime('%d.%m.%Y') }}</div>
                        </div>
                        <div>
                            <small class="text-muted">Период:</small>
                            <div class="fw-bold">
                                {{ start_of_week.strftime('%d.%m') }} - {{ end_of_week.strftime('%d.%m.%Y') }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="bi bi-calendar-week"></i> Расписание группы {{ group_name }}</h2>
                    <div class="btn-group" role="group">
                        <a href="{{ url_for('student_schedule', week_offset=week_offset-1) }}" 
                           class="btn btn-outline-primary">
                            <i class="bi bi-chevron-left"></i> Предыдущая неделя
                        </a>
                        <span class="btn btn-primary">
                            {{ start_of_week.strftime('%d.%m.%Y') }} - {{ end_of_week.strftime('%d.%m.%Y') }}
                        </span>
                        <a href="{{ url_for('student_schedule', week_offset=week_offset+1) }}" 
                           class="btn btn-outline-primary">
                            Следующая неделя <i class="bi bi-chevron-right"></i>
                        </a>
                        {% if week_offset != 0 %}
                        <a href="{{ url_for('student_schedule') }}" class="btn btn-secondary ms-2">
                            Текущая неделя
                        </a>
                        {% endif %}
                    </div>
                </div>

                {% if schedule_by_day %}
                    {% for day, lessons in schedule_by_day.items() %}
                    <div class="card mb-3">
                        <!-- Исправленная строка: используем today_date вместо date.today() -->
                        <div class="card-header {% if day == today_date %}today-header{% elif day < today_date %}past-header{% else %}future-header{% endif %} text-white">
                            <strong>{{ day.strftime('%A, %d.%m.%Y') }}</strong>
                            {% if day == today_date %}
                                <span class="badge bg-warning ms-2">Сегодня</span>
                            {% elif day < today_date %}
                                <span class="badge bg-secondary ms-2">Прошлое</span>
                            {% else %}
                                <span class="badge bg-info ms-2">Будущее</span>
                            {% endif %}
                        </div>
                        <div class="card-body">
                            {% if lessons %}
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Время</th>
                                                <th>Дисциплина</th>
                                                <th>Тип</th>
                                                <th>Аудитория</th>
                                                <th>Преподаватель</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for lesson in lessons %}
                                            <tr>
                                                <td><strong class="lesson-time">{{ lesson[3] }}</strong></td>
                                                <td class="lesson-discipline">{{ lesson[1] }}</td>
                                                <td><span class="badge lesson-type">{{ lesson[5] }}</span></td>
                                                <td class="lesson-classroom">{{ lesson[4] }}</td>
                                                <td class="lesson-teacher">{{ lesson[6] }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <p class="text-muted"><i class="bi bi-info-circle"></i> Занятий нет</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> На выбранную неделю занятий нет
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>

================================================================================
ФАЙЛ: templates\teacher_dashboard.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\teacher_dashboard.html
РАЗМЕР: 11164 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Панель преподавателя</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        body { background-color: #f8f9fa; }
        .dashboard-card { 
            border-radius: 10px; 
            transition: transform 0.2s;
            border: 1px solid #e0e0e0;
        }
        .dashboard-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* ЦВЕТА ДЛЯ ПРЕПОДАВАТЕЛЯ */
        .lesson-card-teacher {
            border-left: 4px solid #198754;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        }
        .lesson-time-teacher {
            font-weight: bold;
            color: #198754;
        }
        .lesson-type-teacher {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .badge-teacher {
            background-color: #20c997;
            color: white;
        }
        .card-header-teacher {
            background: linear-gradient(135deg, #2c8f61 0%, #146c43 100%);
            border-bottom: none;
        }
        .stat-card-teacher {
            border-left: 4px solid #198754;
        }
        .sidebar-teacher {
            border-left: 4px solid #20c997;
        }
        
        /* Кастомные стили для активного пункта меню */
        .list-group-item.active {
            background-color: #198754 !important;
            border-color: #20533c !important;
        }
        
        /* Стиль для карточки Быстрые действия */
        .quick-actions-card .card-header {
            background: linear-gradient(135deg, #3c9958 0%, #0d663d 100%);
        }
        
        /* Стиль для кнопок в Быстрых действиях */
        .quick-actions-card .btn-add-discipline {
            background-color: #20c997;
            border-color: #20c997;
            color: white;
        }
        .quick-actions-card .btn-add-discipline:hover {
            background-color: #17a589;
            border-color: #148f77;
        }
        
        .quick-actions-card .btn-mark-attendance {
            background-color: #198754;
            border-color: #198754;
            color: white;
        }
        .quick-actions-card .btn-mark-attendance:hover {
            background-color: #157347;
            border-color: #146c43;
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ full_name }}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-menu-button"></i> Меню преподавателя
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-speedometer2"></i> Панель
                        </a>
                        <a href="{{ url_for('teacher_disciplines') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-book"></i> Мои дисциплины
                        </a>
                        <a href="{{ url_for('mark_attendance') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-clipboard-check"></i> Отметка посещаемости
                        </a>
                        <a href="{{ url_for('teacher_statistics') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-bar-chart"></i> Статистика
                        </a>
                    </div>
                </div>

                <!-- Быстрые действия -->
                <div class="card quick-actions-card">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-lightning"></i> Быстрые действия
                    </div>
                    <div class="card-body">
                        <a href="{{ url_for('add_discipline') }}" class="btn btn-add-discipline btn-sm w-100 mb-2">
                            <i class="bi bi-plus-circle"></i> Добавить дисциплину
                        </a>
                        <a href="{{ url_for('mark_attendance') }}" class="btn btn-mark-attendance btn-sm w-100">
                            <i class="bi bi-check-circle"></i> Отметить посещаемость
                        </a>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3><i class="bi bi-calendar-day"></i> Мои занятия на сегодня</h3>
                    <span class="badge bg-success">{{ today_date.strftime('%d.%m.%Y') }}</span>
                </div>

                {% if today_schedule %}
                    <div class="row">
                        {% for lesson in today_schedule %}
                        <div class="col-md-6 mb-3">
                            <div class="card dashboard-card h-100 lesson-card-teacher">
                                <div class="card-header card-header-teacher text-white d-flex justify-content-between">
                                    <strong>{{ lesson[1] }}</strong>
                                    <span class="badge badge-teacher">{{ lesson[3] }}</span>
                                </div>
                                <div class="card-body">
                                    <p class="mb-2">
                                        <i class="bi bi-clock text-success"></i> 
                                        <strong class="lesson-time-teacher">{{ lesson[2] }}</strong>
                                    </p>
                                    <p class="mb-2">
                                        <i class="bi bi-geo-alt text-secondary"></i> 
                                        <span class="lesson-classroom-teacher">{{ lesson[4] }}</span>
                                    </p>
                                    <p class="mb-3">
                                        <i class="bi bi-tag text-info"></i> 
                                        <span class="badge lesson-type-teacher">{{ lesson[3] }}</span>
                                    </p>
                                    <a href="{{ url_for('mark_attendance') }}" class="btn btn-outline-success btn-sm">
                                        <i class="bi bi-check-circle"></i> Отметить посещаемость
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> На сегодня занятий нет
                    </div>
                {% endif %}

                <h3 class="mt-5 mb-3"><i class="bi bi-book"></i> Мои дисциплины</h3>
                {% if disciplines %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-success">
                                <tr>
                                    <th>Дисциплина</th>
                                    <th>Часов всего</th>
                                    <th>Группы</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for disc in disciplines %}
                                <tr>
                                    <td><strong>{{ disc[1] }}</strong></td>
                                    <td><span class="badge bg-primary">{{ disc[2] }}</span></td>
                                    <td>
                                        {% if disc[3] and disc[3] != 'Нет групп' %}
                                            {% set groups = disc[3].split(', ') %}
                                            {% for group in groups %}
                                                <span class="badge bg-secondary me-1 mb-1">{{ group }}</span>
                                            {% endfor %}
                                        {% else %}
                                            <span class="text-muted">Группы не назначены</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i> У вас пока нет дисциплин
                        <a href="{{ url_for('add_discipline') }}" class="btn btn-sm btn-success ms-2">
                            <i class="bi bi-plus-circle"></i> Добавить первую дисциплину
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

================================================================================
ФАЙЛ: templates\teacher_disciplines.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\teacher_disciplines.html
РАЗМЕР: 25802 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Мои дисциплины</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        /* Основные стили */
        .btn-add-floating {
            background-color: #20c997;
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
        }
        .btn-add-floating:hover {
            background-color: #17a589;
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }
        .btn-add-floating.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }
        
        /* Стили для карточек дисциплин */
        .discipline-card {
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Добавляем чтобы кнопки не вылазили */
        }
        .discipline-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 25px rgba(25, 135, 84, 0.15);
            border-color: #198754;
        }
        
        /* Заголовок карточки */
        .card-header-teacher {
            background: linear-gradient(135deg, #198754 0%, #146c43 100%);
            border-bottom: none;
            border-top-left-radius: 11px !important;
            border-top-right-radius: 11px !important;
            padding: 1rem;
        }
        
        /* Тело карточки */
        .card-body-teacher {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1.25rem;
            overflow: hidden; /* Защита от переполнения */
        }
        
        /* Стили для бейджей групп */
        .groups-badge {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 20px;
        }
        
        /* Стили для блока групп */
        .groups-container {
            flex: 1;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden; /* Защита от переполнения */
        }
        
        /* Кнопки действий */
        .actions-footer {
            border-top: 1px solid #e9ecef;
            padding-top: 1rem;
            margin-top: auto;
        }
        
        .action-btn {
            border-radius: 8px;
            padding: 0.5rem 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0; /* Важно для корректного сжатия */
        }
        
        .action-btn i {
            font-size: 1rem;
            margin-right: 5px;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Гарантируем что кнопки будут в одну строку */
        .actions-footer .d-flex {
            width: 100%;
            min-width: 0; /* Важно для корректного сжатия */
        }
        
        /* Стили для боковой панели */
        body { background-color: #f8f9fa; }
        .sidebar-teacher {
            border-left: 4px solid #20c997;
        }
        .list-group-item.active {
            background-color: #198754 !important;
            border-color: #20533c !important;
        }
        .quick-actions-card .card-header {
            background: linear-gradient(135deg, #3c9958 0%, #0d663d 100%);
        }
        .quick-actions-card .btn-add-discipline {
            background-color: #20c997;
            border-color: #20c997;
            color: white;
        }
        .quick-actions-card .btn-add-discipline:hover {
            background-color: #17a589;
            border-color: #148f77;
        }
        .quick-actions-card .btn-mark-attendance {
            background-color: #198754;
            border-color: #198754;
            color: white;
        }
        .quick-actions-card .btn-mark-attendance:hover {
            background-color: #157347;
            border-color: #146c43;
        }
        
        /* Анимация для отсутствующих групп */
        .no-groups-message {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        /* Адаптивность для кнопок */
        @media (max-width: 768px) {
            .action-btn span {
                display: none;
            }
            .action-btn i {
                margin-right: 0;
                font-size: 1.1rem; /* Немного увеличим иконки на мобильных */
            }
            .action-btn {
                padding: 0.5rem 0.4rem;
            }
        }
        
        /* Для очень маленьких экранов */
        @media (max-width: 576px) {
            .col-md-6 {
                padding-left: 6px;
                padding-right: 6px;
            }
            .card-body-teacher {
                padding: 1rem;
            }
        }
        
        /* Статистика - равномерное распределение */
        .stats-row {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat-item {
            flex: 1;
            padding: 0.5rem;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            line-height: 1;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        /* Цвета для статистики */
        .stat-primary { color: #0d6efd; }
        .stat-success { color: #198754; }
        .stat-info { color: #0dcaf0; }
        
        @media (max-width: 768px) {
            .stat-number {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-menu-button"></i> Меню преподавателя
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-speedometer2"></i> Панель
                        </a>
                        <a href="{{ url_for('teacher_disciplines') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-book"></i> Мои дисциплины
                        </a>
                        <a href="{{ url_for('mark_attendance') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-clipboard-check"></i> Отметка посещаемости
                        </a>
                        <a href="{{ url_for('teacher_statistics') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-bar-chart"></i> Статистика
                        </a>
                    </div>
                </div>

                <!-- Быстрые действия -->
                <div class="card quick-actions-card">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-lightning"></i> Быстрые действия
                    </div>
                    <div class="card-body">
                        <a href="{{ url_for('add_discipline') }}" class="btn btn-add-discipline btn-sm w-100 mb-2">
                            <i class="bi bi-plus-circle"></i> Добавить дисциплину
                        </a>
                        <a href="{{ url_for('mark_attendance') }}" class="btn btn-mark-attendance btn-sm w-100">
                            <i class="bi bi-check-circle"></i> Отметить посещаемость
                        </a>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <h2><i class="bi bi-book"></i> Мои дисциплины</h2>
                <p class="text-muted">Управление дисциплинами, которые вы преподаёте</p>
                
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                        <div class="alert alert-{{ category if category != 'message' else 'info' }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                {% if disciplines %}
                    <div class="row">
                        {% for disc in disciplines %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card discipline-card h-100">
                                <!-- Заголовок карточки -->
                                <div class="card-header card-header-teacher text-white">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <h5 class="mb-0 text-truncate" title="{{ disc[1] }}">
                                            {{ disc[1] }}
                                        </h5>
                                        <span class="badge bg-light text-dark ms-2">
                                            {{ disc[2] }} ч.
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- Тело карточки -->
                                <div class="card-body card-body-teacher">
                                    <!-- Количество групп -->
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">Назначено групп:</small>
                                            <span class="badge bg-info groups-badge">
                                                {{ disc[4] if disc|length > 4 else 0 }}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Список групп -->
                                    <div class="groups-container mb-3">
                                        {% if disc[3] and disc[3] != 'Нет групп' %}
                                            {% set groups = disc[3].split(', ') %}
                                            <div class="d-flex flex-wrap gap-1">
                                                {% for group in groups[:3] %}
                                                    <span class="badge bg-secondary groups-badge" 
                                                          title="Группа {{ group }}">
                                                        {{ group }}
                                                    </span>
                                                {% endfor %}
                                                {% if groups|length > 3 %}
                                                    <span class="badge bg-light text-dark border groups-badge" 
                                                          title="Ещё {{ groups|length - 3 }} групп">
                                                        +{{ groups|length - 3 }}
                                                    </span>
                                                {% endif %}
                                            </div>
                                        {% else %}
                                            <div class="text-center py-3 no-groups-message">
                                                <i class="bi bi-people display-6 text-muted mb-2 d-block"></i>
                                                <span class="text-muted">Группы не назначены</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Кнопки действий -->
                                    <div class="actions-footer">
                                        <div class="d-flex gap-1" style="min-width: 0;"> <!-- Добавляем min-width: 0 -->
                                            <!-- Кнопка управления группами -->
                                            <a href="{{ url_for('manage_discipline_groups', discipline_id=disc[0]) }}" 
                                               class="btn btn-primary action-btn"
                                               title="Управление группами">
                                                <i class="bi bi-people"></i>
                                                <span class="d-none d-md-inline">Группы</span>
                                            </a>
                                            
                                            <!-- Кнопка редактирования -->
                                            <button class="btn btn-warning action-btn" 
                                                    onclick="editDiscipline({{ disc[0] }})"
                                                    title="Редактировать дисциплину">
                                                <i class="bi bi-pencil"></i>
                                                <span class="d-none d-md-inline">Изменить</span>
                                            </button>
                                            
                                            <!-- Кнопка удаления -->
                                            <button class="btn btn-danger action-btn" 
                                                    onclick="confirmDelete({{ disc[0] }}, '{{ disc[1] }}')"
                                                    title="Удалить дисциплину">
                                                <i class="bi bi-trash"></i>
                                                <span class="d-none d-md-inline">Удалить</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Статистика -->
                    <div class="card mt-4">
                        <div class="card-header bg-light">
                            <i class="bi bi-graph-up"></i> Статистика дисциплин
                        </div>
                        <div class="card-body">
                            <div class="stats-row">
                                <div class="stat-item">
                                    <div class="stat-number stat-primary">{{ disciplines|length }}</div>
                                    <div class="stat-label">Всего дисциплин</div>
                                </div>
                                
                                <div class="stat-item">
                                    {% set total_hours = disciplines|sum(attribute='2') %}
                                    <div class="stat-number stat-success">{{ total_hours }}</div>
                                    <div class="stat-label">Часов всего</div>
                                </div>
                                
                                <div class="stat-item">
                                    {% set total_groups = disciplines|sum(attribute='4') if disciplines[0]|length > 4 else 0 %}
                                    <div class="stat-number stat-info">{{ total_groups }}</div>
                                    <div class="stat-label">Назначений групп</div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-book display-1 text-muted mb-4"></i>
                        <h3 class="text-muted mb-3">У вас пока нет дисциплин</h3>
                        <p class="text-muted mb-4">Добавьте первую дисциплину, чтобы начать работу</p>
                        <a href="{{ url_for('add_discipline') }}" class="btn btn-success btn-lg">
                            <i class="bi bi-plus-circle"></i> Добавить первую дисциплину
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Плавающая кнопка "Добавить дисциплину" -->
    <a href="{{ url_for('add_discipline') }}" 
       class="btn btn-success btn-add-floating"
       id="addButton"
       title="Добавить новую дисциплину">
        <i class="bi bi-plus" style="line-height: 0;"></i>
    </a>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Редактирование дисциплины
        function editDiscipline(disciplineId) {
            window.location.href = `/teacher/discipline/edit/${disciplineId}`;
        }
        
        // Удаление дисциплины
        function confirmDelete(disciplineId, disciplineName) {
            if (confirm(`Вы уверены, что хотите удалить дисциплину "${disciplineName}"?\n\n⚠️ Внимание: Это действие удалит:\n• Все связанные занятия в расписании\n• Все записи о посещаемости\n• Назначения групп\n\nДействие нельзя отменить!`)) {
                // Создаем скрытую форму для удаления
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/teacher/discipline/delete/${disciplineId}`;
                
                // Добавляем CSRF токен если есть
                const csrfToken = document.querySelector('input[name="csrf_token"]');
                if (csrfToken) {
                    form.appendChild(csrfToken.cloneNode(true));
                }
                
                document.body.appendChild(form);
                form.submit();
            }
        }
        
        // Логика скрытия плавающей кнопки при скролле
        let lastScrollTop = 0;
        const addButton = document.getElementById('addButton');
        const scrollThreshold = 100;
        
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > scrollThreshold) {
                addButton.classList.add('hidden');
            } else {
                addButton.classList.remove('hidden');
            }
            
            lastScrollTop = scrollTop;
        });
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            if (window.pageYOffset > scrollThreshold) {
                addButton.classList.add('hidden');
            }
            
            // Добавляем анимацию при наведении на карточки
            const cards = document.querySelectorAll('.discipline-card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.zIndex = '100';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.zIndex = '1';
                });
            });
            
            // Показываем тултипы на мобильных устройствах
            if (window.innerWidth < 768) {
                const actionButtons = document.querySelectorAll('.action-btn');
                actionButtons.forEach(button => {
                    button.setAttribute('data-bs-toggle', 'tooltip');
                    button.setAttribute('data-bs-placement', 'top');
                });
                
                // Инициализация тултипов Bootstrap
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl, {
                        trigger: 'hover'
                    });
                });
            }
            
            // Проверяем ширину кнопок и при необходимости скрываем текст
            function checkButtonWidth() {
                const buttons = document.querySelectorAll('.action-btn');
                buttons.forEach(button => {
                    const parentWidth = button.parentElement.offsetWidth;
                    const buttonWidth = button.offsetWidth;
                    
                    // Если кнопки переполняют контейнер, скрываем текст
                    if (parentWidth < 250) { // Примерный порог
                        const textSpan = button.querySelector('span');
                        if (textSpan) {
                            textSpan.style.display = 'none';
                        }
                    }
                });
            }
            
            // Проверяем при загрузке и при изменении размера окна
            checkButtonWidth();
            window.addEventListener('resize', checkButtonWidth);
        });
    </script>
</body>
</html>

================================================================================
ФАЙЛ: templates\teacher_statistics.html
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\templates\teacher_statistics.html
РАЗМЕР: 11929 байт
================================================================================

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Статистика посещаемости</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='favic.ico') }}">
    <style>
        /* Существующие стили */
        .stat-table th { 
            background: linear-gradient(135deg, #198754 0%, #146c43 100%);
            color: white;
        }
        .percentage { 
            font-size: 0.9em; 
            color: #6c757d;
        }
        .progress-bar-present {
            background: linear-gradient(90deg, #198754 0%, #20c997 100%);
        }
        .progress-bar-absent {
            background: linear-gradient(90deg, #dc3545 0%, #e35d6a 100%);
        }
        .progress-bar-excused {
            background: linear-gradient(90deg, #ffc107 0%, #ffda6a 100%);
        }
        .progress-bar-late {
            background: linear-gradient(90deg, #17a2b8 0%, #5bc0de 100%);
        }
        .text-present { color: #198754; }
        .text-absent { color: #dc3545; }
        .text-excused { color: #ffc107; }
        .text-late { color: #17a2b8; }
        
        /* Стили для боковой панели */
        body { background-color: #f8f9fa; }
        .sidebar-teacher {
            border-left: 4px solid #20c997;
        }
        .list-group-item.active {
            background-color: #198754 !important;
            border-color: #20533c !important;
        }
        .quick-actions-card .card-header {
            background: linear-gradient(135deg, #3c9958 0%, #0d663d 100%);
        }
        .quick-actions-card .btn-add-discipline {
            background-color: #20c997;
            border-color: #20c997;
            color: white;
        }
        .quick-actions-card .btn-add-discipline:hover {
            background-color: #17a589;
            border-color: #148f77;
        }
        .quick-actions-card .btn-mark-attendance {
            background-color: #198754;
            border-color: #198754;
            color: white;
        }
        .quick-actions-card .btn-mark-attendance:hover {
            background-color: #157347;
            border-color: #146c43;
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success shadow">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="bi bi-mortarboard"></i> Учёт посещаемости
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link text-white">
                    <i class="bi bi-person-circle"></i> {{ session['full_name'] }}
                </span>
                <a class="nav-item nav-link text-white" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Левое меню -->
            <div class="col-md-3">
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-menu-button"></i> Меню преподавателя
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-speedometer2"></i> Панель
                        </a>
                        <a href="{{ url_for('teacher_disciplines') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-book"></i> Мои дисциплины
                        </a>
                        <a href="{{ url_for('mark_attendance') }}" class="list-group-item list-group-item-action">
                            <i class="bi bi-clipboard-check"></i> Отметка посещаемости
                        </a>
                        <a href="{{ url_for('teacher_statistics') }}" class="list-group-item list-group-item-action active">
                            <i class="bi bi-bar-chart"></i> Статистика
                        </a>
                    </div>
                </div>

                <!-- Быстрые действия -->
                <div class="card quick-actions-card">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-lightning"></i> Быстрые действия
                    </div>
                    <div class="card-body">
                        <a href="{{ url_for('add_discipline') }}" class="btn btn-add-discipline btn-sm w-100 mb-2">
                            <i class="bi bi-plus-circle"></i> Добавить дисциплину
                        </a>
                        <a href="{{ url_for('mark_attendance') }}" class="btn btn-mark-attendance btn-sm w-100">
                            <i class="bi bi-check-circle"></i> Отметить посещаемость
                        </a>
                    </div>
                </div>
            </div>

            <!-- Основной контент -->
            <div class="col-md-9">
                <h2><i class="bi bi-bar-chart"></i> Статистика посещаемости</h2>
                
                <!-- Фильтр -->
                <div class="card mb-4">
                    <div class="card-body">
                        <form method="GET" class="row g-3">
                            <div class="col-md-3">
                                <label>Группа</label>
                                <select class="form-select" name="group_id">
                                    <option value="">Все группы</option>
                                    {% for group in groups %}
                                    <option value="{{ group[0] }}" {% if selected_group == group[0]|string %}selected{% endif %}>
                                        {{ group[1] }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                           <div class="col-md-3">
                                <label>Студент</label>
                                <select class="form-select" name="student_id">
                                    <option value="">Все студенты</option>
                                    {% for student in students %}
                                    <option value="{{ student[0] }}" {% if selected_student == student[0]|string %}selected{% endif %}>
                                        {{ student[1] }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label>Начальная дата</label>
                                <input type="date" name="start_date" class="form-control" 
                                       value="{{ start_date.strftime('%Y-%m-%d') }}">
                            </div>
                            <div class="col-md-3">
                                <label>Конечная дата</label>
                                <input type="date" name="end_date" class="form-control" 
                                       value="{{ end_date.strftime('%Y-%m-%d') }}">
                            </div>
                            <div class="col-12 mt-2">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-filter"></i> Применить фильтр
                                </button>
                                <a href="{{ url_for('teacher_statistics') }}" class="btn btn-secondary">
                                    <i class="bi bi-x-circle"></i> Сбросить
                                </a>
                            </div>
                        </form>
                    </div>
                </div>

                {% if statistics %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover stat-table">
                            <thead>
                                <tr>
                                    <th>Студент</th>
                                    <th>Дисциплина</th>
                                    <th>Всего занятий</th>
                                    <th>Присутствовал</th>
                                    <th>Отсутствовал</th>
                                    <th>Уважительная</th>
                                    <th>Опоздал</th>
                                    <th>Посещаемость</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in statistics %}
                                <tr>
                                    <td><strong>{{ stat[0] }}</strong></td>
                                    <td>{{ stat[1] }}</td>
                                    <td>{{ stat[2] }}</td>
                                    <td class="text-success">{{ stat[3] }}</td>
                                    <td class="text-danger">{{ stat[4] }}</td>
                                    <td class="text-warning">{{ stat[5] }}</td>
                                    <td>{{ stat[6] }}</td>
                                    <td>
                                        {% if stat[2] > 0 %}
                                            {% set attendance_rate = (stat[3] / stat[2] * 100)|round(1) %}
                                            <div class="progress" style="height: 20px;">
                                                <div class="progress-bar progress-bar-present" style="width: {{ attendance_rate }}%">
                                                    {{ attendance_rate }}%
                                                </div>
                                            </div>
                                        {% else %}
                                            <span class="text-muted">Нет данных</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% elif selected_group or selected_student %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> По выбранным критериям данных не найдено
                    </div>
                {% else %}
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i> Выберите критерии для отображения статистики
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>

================================================================================
ФАЙЛ: tests\test_basic.py
ПОЛНЫЙ ПУТЬ: C:\Users\Makar\Desktop\kyrsovay\tests\test_basic.py
РАЗМЕР: 30726 байт
================================================================================

import pytest
from unittest.mock import Mock, patch, MagicMock
import sys
import os
from datetime import date, datetime, timedelta

# Добавляем путь к проекту
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

# ========== ФИКСТУРЫ ==========

@pytest.fixture
def client():
    """Создаем тестовый клиент Flask"""
    from main import app
    app.config['TESTING'] = True
    app.config['SECRET_KEY'] = 'test-secret-key'  # Тестовый ключ
    app.config['WTF_CSRF_ENABLED'] = False  # Отключаем CSRF для тестов
    with app.test_client() as client:
        yield client

@pytest.fixture
def mock_db():
    """Создаем мок базы данных с расширенной функциональностью"""
    mock = Mock()
    
    # Мокируем данные пользователей
    def get_user_by_login(login):
        users = {
            'student1': [(1, 'student1', 'student123', 'Сидоров Иван Алексеевич', 'Студент', None, 1)],
            'teacher1': [(2, 'teacher1', 'teacher123', 'Иванова Мария Петровна', 'Преподаватель', None, None)],
            'admin': [(3, 'admin', 'admin123', 'Администратор Системы', 'Администратор', None, None)]
        }
        return users.get(login, [])
    
    # Мокируем execute_query с разными сценариями
    def execute_query(query, params=None, fetch=True):
        # Мок для информации о группе
        if 'group_code FROM student_groups' in query and params == (1,):
            return [(1, 'ИВТ-101')]
        # Мок для расписания
        elif 'WHERE s.group_id = %s AND s.lesson_date BETWEEN' in query:
            return []  # Пустое расписание
        # Мок для статистики
        elif 'FROM attendance a' in query and 'WHERE a.student_id' in query and 's.lesson_date' in query:
            return [(30, 25, 3, 2, 0)]  # total, attended, absent, excused, late
        # Мок для дисциплин преподавателя
        elif 'WHERE d.teacher_id = %s' in query:
            return [(1, 'Математика', 100, 'ИВТ-101, ИВТ-201', 2)]
        # Мок для всех групп
        elif 'SELECT id, group_code FROM student_groups' in query and 'ORDER BY group_code' in query:
            return [(1, 'ИВТ-101'), (2, 'ИВТ-201')]
        # Мок для дисциплин студента
        elif 'WHERE gd.group_id = %s' in query:
            return [('Математика', 100, 1), ('Физика', 80, 1)]
        # Мок для пользователей
        elif 'FROM users u' in query:
            return [
                (1, 'student1', 'Сидоров Иван', 'Студент', 'sidorov@university.ru', None, 'ИВТ-101'),
                (2, 'teacher1', 'Иванова Мария', 'Преподаватель', 'ivanova@university.ru', None, None)
            ]
        # Мок для групп
        elif 'FROM student_groups g' in query and 'GROUP BY' in query:
            return [
                (1, 'ИВТ-101', 'Информатика', 1, 25),
                (2, 'ИВТ-201', 'Информатика', 2, 30)
            ]
        # Мок для статистики системы
        elif 'SELECT COUNT(*) FROM users' in query:
            return [(150, 20, 10, 45, 15, 120)]  # student_count, teacher_count, group_count, discipline_count, recent_classes, recent_attendance
        # Мок для статистики посещаемости
        elif 'FROM attendance a' in query and 'WHERE u.role' in query:
            return [(85.5, 8.2, 4.3, 2.0)]  # attendance_percent, absence_percent, excused_percent, late_percent
        # Мок для посещаемости студента - ВАЖНО: возвращаем даты как datetime/date объекты
        elif 'FROM attendance a' in query and 'WHERE a.student_id = %s' in query:
            return [
                (1, 'Математика', date.today(), '09:00', 'Присутствовал', '', 'Иванова М.П.', '301'),
                (2, 'Физика', date.today() - timedelta(days=1), '11:00', 'Отсутствовал', 'Болел', 'Петров А.С.', '302')
            ]
        # Мок для пустой посещаемости (если не указаны параметры дат)
        elif 'WHERE a.student_id = %s AND s.lesson_date BETWEEN' in query:
            if params and len(params) >= 3:
                student_id, start_date, end_date = params[0], params[1], params[2]
                return [
                    (1, 'Математика', start_date, '09:00', 'Присутствовал', '', 'Иванова М.П.', '301'),
                    (2, 'Физика', end_date, '11:00', 'Отсутствовал', 'Болел', 'Петров А.С.', '302')
                ]
            else:
                return []
        return []
    
    mock.get_user_by_login.side_effect = get_user_by_login
    mock.execute_query.side_effect = execute_query
    mock.execute_insert.return_value = True
    mock.connect.return_value = True
    mock.close.return_value = None
    
    return mock

@pytest.fixture
def mock_db_with_errors():
    """Мок БД с ошибками для тестирования обработки ошибок"""
    mock = Mock()
    mock.connect.return_value = False
    mock.execute_query.side_effect = Exception("Database connection error")
    mock.execute_insert.side_effect = Exception("Insert failed")
    return mock

# ========== ТЕСТЫ БИЗНЕС-ЛОГИКИ (вместо тестов 14-20) ==========

def test_get_today_schedule_function():
    """Тест вспомогательной функции get_today_schedule"""
    from main import get_today_schedule
    
    with patch('main.db') as mock_db:
        # Мок для студента
        mock_db.execute_query.return_value = [
            (1, 'Математика', '09:00', '301', 'Лекция', 'Иванова М.П.', date.today())
        ]
        
        result = get_today_schedule(1, 'Студент', 1)
        assert len(result) == 1
        assert result[0][1] == 'Математика'
        assert result[0][3] == '301'
        
        # Мок для преподавателя
        mock_db.execute_query.return_value = [
            (1, 'Математика', '09:00', '301', 'Лекция', 'ИВТ-101', date.today())
        ]
        
        result = get_today_schedule(2, 'Преподаватель', None)
        assert len(result) == 1
        assert result[0][5] == 'ИВТ-101'
        
        # Мок для администратора
        mock_db.execute_query.return_value = [
            (1, 'Математика', '09:00', '301', 'Лекция', 'ИВТ-101', 'Иванова М.П.', date.today())
        ]
        
        result = get_today_schedule(3, 'Администратор', None)
        assert len(result) == 1
        assert result[0][6] == 'Иванова М.П.'

def test_get_student_attendance_function():
    """Тест функции получения посещаемости студента"""
    from main import get_student_attendance
    
    with patch('main.db') as mock_db:
        mock_db.execute_query.return_value = [
            (1, 'Математика', date.today(), '09:00', 'Присутствовал', '', 'Иванова М.П.', '301'),
            (2, 'Физика', date.today(), '11:00', 'Отсутствовал', 'Болел', 'Петров А.С.', '302')
        ]
        
        result = get_student_attendance(1)
        assert len(result) == 2
        assert result[0][1] == 'Математика'
        assert result[0][4] == 'Присутствовал'
        assert result[1][1] == 'Физика'
        assert result[1][4] == 'Отсутствовал'
        
        # Тест с указанием дат
        start_date = date.today() - timedelta(days=7)
        end_date = date.today()
        result = get_student_attendance(1, start_date, end_date)
        assert mock_db.execute_query.called
        call_args = mock_db.execute_query.call_args[0][1]
        assert len(call_args) == 3  # student_id, start_date, end_date

def test_get_teacher_disciplines_function():
    """Тест функции получения дисциплин преподавателя"""
    from main import get_teacher_disciplines
    
    with patch('main.db') as mock_db:
        mock_db.execute_query.return_value = [
            (1, 'Математика', 100, 'ИВТ-101, ИВТ-201'),
            (2, 'Физика', 80, 'ИВТ-101')
        ]
        
        result = get_teacher_disciplines(2)
        assert len(result) == 2
        assert result[0][1] == 'Математика'
        assert result[0][3] == 'ИВТ-101, ИВТ-201'
        assert result[1][1] == 'Физика'
        assert result[1][2] == 80

def test_db_error_handling():
    """Тест обработки ошибок базы данных"""
    from main import app
    
    with patch('main.db') as mock_db:
        mock_db.connect.return_value = False
        
        # Проверяем что приложение не падает при ошибке подключения
        with app.app_context():
            from main import db
            assert db.connect() == False
        
        # Тест ошибки выполнения запроса - используем фикстуру
        # Этот тест проверяет что ошибка возникает, а не обрабатывается
        mock_db.execute_query.side_effect = Exception("Query failed")
        try:
            result = mock_db.execute_query("SELECT * FROM users")
            # Если мы здесь, значит исключение не было брошено
            assert False, "Expected exception but none was raised"
        except Exception as e:
            assert str(e) == "Query failed"

def test_flash_messages_display(client):
    """Тест отображения flash сообщений"""
    with client.session_transaction() as session:
        session['user_id'] = 1
        session['login'] = 'student1'
        session['full_name'] = 'Student'
        session['role'] = 'Студент'
        session['group_id'] = 1
    
    # Проверяем flash сообщения при доступе к запрещенной странице
    response = client.get('/teacher/disciplines', follow_redirects=True)
    assert response.status_code == 200
    html = response.data.decode('utf-8', errors='ignore').lower()
    # В вашем коде есть flash('Доступ запрещен')
    assert 'доступ запрещен' in html or 'alert' in html or 'warning' in html

def test_form_validation_edge_cases(client, mock_db):
    """Тест граничных случаев валидации форм"""
    
    # Тест добавления дисциплины с некорректным количеством часов
    with client.session_transaction() as session:
        session['user_id'] = 2
        session['login'] = 'teacher1'
        session['full_name'] = 'Teacher'
        session['role'] = 'Преподаватель'
    
    with patch('main.db', mock_db):
        # Нулевые часы
        response = client.post('/teacher/discipline/add', data={
            'name': 'Test Discipline',
            'total_hours': '0',  # Некорректное значение
            'groups': ['1'],
            'semester_1': '1'
        }, follow_redirects=True)
        
        assert response.status_code == 200
        html = response.data.decode('utf-8', errors='ignore').lower()
        # Проверяем что форма не прошла валидацию
        assert 'дисциплину' in html or 'discipline' in html or 'форма' in html
        
        # Отрицательные часы
        response = client.post('/teacher/discipline/add', data={
            'name': 'Test Discipline',
            'total_hours': '-10',  # Некорректное значение
            'groups': ['1'],
            'semester_1': '1'
        }, follow_redirects=True)
        
        assert response.status_code == 200
        
        # Слишком большой семестр
        response = client.post('/teacher/discipline/add', data={
            'name': 'Test Discipline',
            'total_hours': '100',
            'groups': ['1'],
            'semester_1': '13'  # Некорректное значение (макс 12)
        }, follow_redirects=True)
        
        assert response.status_code == 200

def test_app_configuration():
    """Тест конфигурации приложения"""
    from main import app
    
    # Сохраняем оригинальные значения
    original_secret_key = app.config['SECRET_KEY']
    original_testing = app.config.get('TESTING', False)
    
    # Восстанавливаем оригинальный SECRET_KEY для проверки
    app.config['SECRET_KEY'] = 'your-secret-key-here'
    app.config['TESTING'] = False
    
    try:
        assert app.config['SECRET_KEY'] == 'your-secret-key-here'
        assert app.config['PERMANENT_SESSION_LIFETIME'] == timedelta(hours=2)
        assert app.config['TESTING'] == False
    finally:
        # Восстанавливаем оригинальные значения
        app.config['SECRET_KEY'] = original_secret_key
        app.config['TESTING'] = original_testing

def test_db_insert_operations(mock_db):
    """Тест операций вставки в базу данных"""
    # Тест успешной вставки
    assert mock_db.execute_insert(
        "INSERT INTO users (login, password_hash, full_name, role) VALUES (%s, %s, %s, %s)",
        ('testuser', 'testpass', 'Test User', 'Студент')
    ) == True
    
    # Тест вставки с возвратом ID
    mock_db.execute_insert.return_value = 100  # Возвращаем ID
    result = mock_db.execute_insert(
        "INSERT INTO users (login, password_hash, full_name, role) VALUES (%s, %s, %s, %s) RETURNING id",
        ('testuser2', 'testpass2', 'Test User 2', 'Студент'),
        return_id=True
    )
    assert result == 100

def test_db_query_operations(mock_db):
    """Тест операций запросов к базе данных"""
    # Тест запроса пользователя
    result = mock_db.get_user_by_login('student1')
    assert len(result) == 1
    assert result[0][1] == 'student1'
    assert result[0][4] == 'Студент'
    
    # Тест запроса расписания
    result = mock_db.execute_query("SELECT * FROM schedule WHERE group_id = %s", (1,))
    assert result is not None
    
    # Тест запроса с параметрами
    result = mock_db.execute_query("SELECT * FROM users WHERE role = %s", ('Студент',))
    assert isinstance(result, list)

def test_session_management(client):
    """Тест управления сессиями"""
    with client.session_transaction() as session:
        # Устанавливаем данные сессии
        session['user_id'] = 123
        session['login'] = 'testuser'
        session['full_name'] = 'Test User'
        session['role'] = 'Студент'
        session['group_id'] = 1
        
        # Проверяем сохранение
        assert session['user_id'] == 123
        assert session['login'] == 'testuser'
        assert session['role'] == 'Студент'
    
    # Проверяем что сессия очищается после logout
    response = client.get('/logout', follow_redirects=True)
    assert response.status_code == 200
    
    with client.session_transaction() as session:
        assert 'user_id' not in session
        assert 'login' not in session

# ========== СУЩЕСТВУЮЩИЕ ТЕСТЫ (обновленные) ==========

def test_student_cannot_access_teacher_routes(client):
    """Студент не может получить доступ к маршрутам преподавателя"""
    with client.session_transaction() as session:
        session['user_id'] = 1
        session['login'] = 'student1'
        session['full_name'] = 'Сидоров Иван'
        session['role'] = 'Студент'
        session['group_id'] = 1
    
    response = client.get('/teacher/disciplines', follow_redirects=True)
    assert response.status_code == 200
    html = response.data.decode('utf-8', errors='ignore').lower()
    assert 'доступ запрещен' in html or 'dashboard' in html or 'панель' in html

def test_student_cannot_access_admin_routes(client):
    """Студент не может получить доступ к маршрутам администратора"""
    with client.session_transaction() as session:
        session['user_id'] = 1
        session['login'] = 'student1'
        session['full_name'] = 'Сидоров Иван'
        session['role'] = 'Студент'
        session['group_id'] = 1
    
    response = client.get('/admin/users', follow_redirects=True)
    assert response.status_code == 200
    html = response.data.decode('utf-8', errors='ignore').lower()
    assert 'доступ запрещен' in html or 'dashboard' in html or 'панель' in html

def test_teacher_cannot_access_admin_routes(client):
    """Преподаватель не может получить доступ к маршрутам администратора"""
    with client.session_transaction() as session:
        session['user_id'] = 2
        session['login'] = 'teacher1'
        session['full_name'] = 'Иванова Мария'
        session['role'] = 'Преподаватель'
    
    response = client.get('/admin/users', follow_redirects=True)
    assert response.status_code == 200
    html = response.data.decode('utf-8', errors='ignore').lower()
    assert 'доступ запрещен' in html or 'dashboard' in html or 'панель' in html

def test_student_attendance_page(client, mock_db):
    """Страница посещаемости студента загружается с данными"""
    with client.session_transaction() as session:
        session['user_id'] = 1
        session['login'] = 'student1'
        session['full_name'] = 'Сидоров Иван'
        session['role'] = 'Студент'
        session['group_id'] = 1
    
    with patch('main.db', mock_db):
        # Импортируем функцию get_student_attendance чтобы она использовала мок
        with patch('main.get_student_attendance') as mock_attendance:
            # Мокаем функцию чтобы она возвращала корректные данные с date объектами
            mock_attendance.return_value = [
                (1, 'Математика', date.today(), '09:00', 'Присутствовал', '', 'Иванова М.П.', '301'),
                (2, 'Физика', date.today() - timedelta(days=1), '11:00', 'Отсутствовал', 'Болел', 'Петров А.С.', '302')
            ]
            
            response = client.get('/student/attendance', follow_redirects=True)
            
            assert response.status_code == 200
            html = response.data.decode('utf-8', errors='ignore').lower()
            assert 'посещаемость' in html or 'attendance' in html
            
            # Проверяем что есть форма фильтрации
            assert 'start_date' in html or 'end_date' in html or 'фильтр' in html

def test_teacher_add_discipline(client, mock_db):
    """Преподаватель может добавить дисциплину"""
    with client.session_transaction() as session:
        session['user_id'] = 2
        session['login'] = 'teacher1'
        session['full_name'] = 'Иванова Мария'
        session['role'] = 'Преподаватель'
    
    with patch('main.db', mock_db):
        response = client.post('/teacher/discipline/add', data={
            'name': 'Новая дисциплина',
            'description': 'Описание дисциплины',
            'total_hours': '100',
            'groups': ['1'],
            'semester_1': '1'
        }, follow_redirects=True)
        
        assert response.status_code == 200
        html = response.data.decode('utf-8', errors='ignore').lower()
        # После успешного добавления должно быть сообщение и редирект
        assert 'успешно' in html or 'дисциплины' in html or 'success' in html

def test_admin_add_user(client, mock_db):
    """Администратор может добавить пользователя"""
    with client.session_transaction() as session:
        session['user_id'] = 3
        session['login'] = 'admin'
        session['full_name'] = 'Администратор'
        session['role'] = 'Администратор'
    
    with patch('main.db', mock_db):
        response = client.post('/admin/user/add', data={
            'login': 'newuser',
            'password': 'newpass123',
            'full_name': 'Новый пользователь',
            'role': 'Студент',
            'email': 'new@university.ru',
            'group_id': '1'
        }, follow_redirects=True)
        
        assert response.status_code == 200
        html = response.data.decode('utf-8', errors='ignore').lower()
        # После успешного добавления должно быть сообщение
        assert 'успешно' in html or 'пользователь' in html or 'success' in html

def test_add_user_validation(client, mock_db):
    """Валидация формы добавления пользователя"""
    with client.session_transaction() as session:
        session['user_id'] = 3
        session['login'] = 'admin'
        session['full_name'] = 'Администратор'
        session['role'] = 'Администратор'
    
    with patch('main.db', mock_db):
        # Пустая форма
        response = client.post('/admin/user/add', data={
            'login': '',
            'password': '',
            'full_name': '',
            'role': ''
        }, follow_redirects=True)
        
        assert response.status_code == 200
        html = response.data.decode('utf-8', errors='ignore').lower()
        # Должны остаться на странице формы
        assert 'пользователя' in html or 'user' in html or 'форма' in html
        
        # Некорректная роль
        response = client.post('/admin/user/add', data={
            'login': 'test',
            'password': 'test',
            'full_name': 'Test',
            'role': 'InvalidRole'  # Некорректная роль
        }, follow_redirects=True)
        
        assert response.status_code == 200

def test_add_discipline_without_groups(client, mock_db):
    """Попытка добавить дисциплину без групп"""
    with client.session_transaction() as session:
        session['user_id'] = 2
        session['login'] = 'teacher1'
        session['full_name'] = 'Teacher'
        session['role'] = 'Преподаватель'
    
    with patch('main.db', mock_db):
        response = client.post('/teacher/discipline/add', data={
            'name': 'Test Discipline',
            'total_hours': '100'
            # groups не указаны
        }, follow_redirects=True)
        
        assert response.status_code == 200
        html = response.data.decode('utf-8', errors='ignore').lower()
        # Проверяем что остались на той же странице (ошибка валидации)
        assert 'дисциплину' in html or 'discipline' in html or 'форма' in html

def test_user_authentication_flow(client, mock_db):
    """Полный цикл аутентификации пользователя"""
    with patch('main.db', mock_db):
        # 1. Логин
        response = client.post('/login', data={
            'login': 'student1',
            'password': 'student123'
        }, follow_redirects=True)
        
        assert response.status_code == 200
        html = response.data.decode('utf-8', errors='ignore').lower()
        assert 'добро пожаловать' in html or 'панель' in html or 'dashboard' in html
        
        # 2. Доступ к dashboard
        response = client.get('/dashboard')
        assert response.status_code == 200
        
        # 3. Выход
        response = client.get('/logout', follow_redirects=True)
        assert response.status_code == 200
        
        # 4. Проверка что вышел
        response = client.get('/dashboard', follow_redirects=True)
        html = response.data.decode('utf-8', errors='ignore').lower()
        assert 'login' in html or 'вход' in html

def test_access_control_routes(client):
    """Тест контроля доступа ко всем защищенным маршрутам"""
    routes_to_test = [
        ('/dashboard', False, 'Все'),
        ('/student/schedule', True, 'Только студенты'),
        ('/teacher/disciplines', True, 'Только преподаватели'),
        ('/admin/users', True, 'Только администраторы')
    ]
    
    for route, requires_auth, description in routes_to_test:
        response = client.get(route, follow_redirects=True)
        
        if requires_auth:
            # Должен быть редирект на логин
            assert response.status_code == 200
            html = response.data.decode('utf-8', errors='ignore').lower()
            assert 'login' in html or 'вход' in html
        else:
            # Главная страница редиректит на логин
            if route == '/dashboard':
                assert response.status_code == 200
                html = response.data.decode('utf-8', errors='ignore').lower()
                assert 'login' in html or 'вход' in html

# ========== БАЗОВЫЕ ТЕСТЫ ПРИЛОЖЕНИЯ ==========

def test_home_redirects_to_login(client):
    """Главная страница перенаправляет на логин"""
    response = client.get('/')
    assert response.status_code == 302
    assert '/login' in response.location

def test_login_page_loads(client):
    """Страница логина загружается"""
    response = client.get('/login')
    assert response.status_code == 200
    html = response.data.decode('utf-8', errors='ignore').lower()
    assert 'form' in html or 'login' in html or 'вход' in html

def test_student_login_success(client, mock_db):
    """Успешный вход студента"""
    with patch('main.db', mock_db):
        response = client.post('/login', data={
            'login': 'student1',
            'password': 'student123'
        }, follow_redirects=True)
        
        assert response.status_code == 200
        html = response.data.decode('utf-8', errors='ignore').lower()
        assert 'добро пожаловать' in html or 'панель' in html or 'dashboard' in html

def test_login_failed_wrong_credentials(client, mock_db):
    """Неудачный вход с неправильными данными"""
    with patch('main.db', mock_db):
        response = client.post('/login', data={
            'login': 'wrong',
            'password': 'wrong'
        }, follow_redirects=True)
        
        assert response.status_code == 200
        html = response.data.decode('utf-8', errors='ignore').lower()
        assert 'неверный' in html or 'ошибка' in html or 'login' in html

def test_logout(client):
    """Выход из системы"""
    with client.session_transaction() as session:
        session['user_id'] = 1
        session['login'] = 'test'
        session['full_name'] = 'Test'
        session['role'] = 'Студент'
    
    response = client.get('/logout', follow_redirects=True)
    assert response.status_code == 200
    html = response.data.decode('utf-8', errors='ignore').lower()
    assert 'login' in html or 'вход' in html or 'вышли' in html

def test_database_connection():
    """Тест инициализации базы данных"""
    from db import Database
    
    db = Database(
        host='localhost',
        database='test_db',
        user='test_user',
        password='test_pass'
    )
    
    assert db.host == 'localhost'
    assert db.database == 'test_db'
    assert db.user == 'test_user'
    assert db.password == 'test_pass'
    assert db.conn is None
    
    # Тест подключения
    with patch('db.psycopg2.connect') as mock_connect:
        mock_connect.return_value = MagicMock()
        assert db.connect() == True
        assert db.conn is not None
        
        # Тест закрытия
        db.close()
        assert db.conn.close.called

def test_nonexistent_route(client):
    """Запрос несуществующего маршрута"""
    response = client.get('/nonexistent-route')
    assert response.status_code == 404

def test_method_not_allowed(client):
    """Использование неправильного метода HTTP"""
    response = client.post('/')  # POST на главную страницу
    assert response.status_code == 405  # Method Not Allowed
